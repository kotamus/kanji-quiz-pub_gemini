<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="manifest.json">
    <title>Êº¢Â≠ó„ÇØ„Ç§„Ç∫</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', 'Yu Gothic', YuGothic, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 500px;
            width: 100%;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .grade-selector, .mode-selector {
            margin-bottom: 30px;
        }

        .grade-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .mode-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .grade-btn, .mode-btn {
            background: #f0f0f0;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn {
            padding: 25px;
            font-size: 18px;
        }

        .grade-btn:hover, .mode-btn:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .grade-btn.active, .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .quiz-container {
            display: none;
            position: relative;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .back-to-top-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-to-top-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .question-counter {
            font-size: 16px;
            color: #666;
        }

        .question {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .question-text {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }

        .reading-text {
            font-size: 18px;
            color: #666;
        }

        .writing-display {
            font-size: 48px;
            color: #333;
            margin: 20px 0;
            font-weight: bold;
        }

        .writing-instruction {
            font-size: 20px;
            color: #666;
            margin-bottom: 10px;
        }

        #writingHint {
            font-size: 16px;
            color: #888;
            background: #f0f0f0;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 20px;
        }

        .self-check-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        .check-btn {
            padding: 20px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .check-btn.correct {
            background: #4caf50;
            color: white;
        }

        .check-btn.incorrect {
            background: #f44336;
            color: white;
        }

        .check-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .choices {
            display: grid;
            gap: 15px;
        }

        .choice-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 20px;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .choice-btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .choice-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .choice-btn.incorrect {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .result {
            text-align: center;
            padding: 20px;
            font-size: 20px;
            display: none;
        }

        .score {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }

        .restart-btn, .back-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .restart-btn:hover, .back-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .progress {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            background: #667eea;
            height: 100%;
            width: 0;
            transition: width 0.3s ease;
        }

        .loader {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .loader-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .mode-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .show-answer-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .show-answer-btn:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .answer-display {
            font-size: 36px;
            color: #4caf50;
            margin-top: 20px;
            font-weight: bold;
            display: none;
        }

        /* „Ç´„Çπ„Çø„É†„É¢„Éº„ÉÄ„É´ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-message {
            font-size: 18px;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.ok {
            background: #f44336;
            color: white;
        }

        .modal-btn.cancel {
            background: #6c757d;
            color: white;
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* ÁÆ°ÁêÜÁîªÈù¢ */
        .admin-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .admin-panel .container {
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .close-admin-btn {
            background: #6c757d;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-admin-btn:hover {
            background: #5a6268;
            transform: scale(1.1);
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-tab {
            background: #f0f0f0;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-tab.active, .admin-tab:hover {
            background: #667eea;
            color: white;
        }

        .admin-content {
            min-height: 300px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: #667eea;
            outline: none;
        }

        .add-question-btn, .import-btn, .export-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .add-question-btn:hover, .import-btn:hover, .export-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .add-result, .import-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            display: none;
        }

        .add-result.success, .import-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .add-result.error, .import-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .question-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .question-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .question-item h4 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .question-item p {
            margin: 5px 0;
            color: #666;
        }

        .export-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .export-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        /* „É¢„Éê„Ç§„É´ÂØæÂøú */
        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }
            
            .quiz-header {
                margin-bottom: 10px;
            }
            
            .back-to-top-btn {
                padding: 6px 15px;
                font-size: 13px;
            }
            
            .question-counter {
                font-size: 14px;
            }
            
            .writing-display {
                font-size: 36px;
            }
            
            .answer-display {
                font-size: 28px;
            }
            
            .modal-content {
                padding: 20px;
                margin: 0 10px;
            }
            
            .modal-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö Êº¢Â≠ó„ÇØ„Ç§„Ç∫</h1>

        <div class="grade-selector" id="gradeSelector">
            <p style="text-align: center; margin-bottom: 15px; color: #666;">Â≠¶Âπ¥„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</p>
            <div class="grade-buttons">
                <button class="grade-btn" data-grade="1">1Âπ¥Áîü</button>
                <button class="grade-btn" data-grade="2">2Âπ¥Áîü</button>
                <button class="grade-btn" data-grade="3">3Âπ¥Áîü</button>
                <button class="grade-btn" data-grade="4">4Âπ¥Áîü</button>
                <button class="grade-btn" data-grade="5">5Âπ¥Áîü</button>
                <button class="grade-btn" data-grade="6">6Âπ¥Áîü</button>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="admin-btn" onclick="showAdminPanel()">üìù ÂïèÈ°åÁÆ°ÁêÜ</button>
            </div>
        </div>

        <div class="mode-selector" id="modeSelector" style="display: none;">
            <p style="text-align: center; margin-bottom: 15px; color: #666;">„ÉÜ„Çπ„Éà„ÅÆÁ®ÆÈ°û„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</p>
            <div class="mode-buttons">
                <button class="mode-btn" data-mode="reading">
                    <div class="mode-icon">üìñ</div>
                    Ë™≠„Åø„ÉÜ„Çπ„Éà
                </button>
                <button class="mode-btn" data-mode="writing">
                    <div class="mode-icon">‚úèÔ∏è</div>
                    Êõ∏„Åç„ÉÜ„Çπ„Éà
                </button>
            </div>
        </div>

        <div class="loader" id="loader">
            <div class="loader-spinner"></div>
            <p style="margin-top: 20px; color: #666;">ÂïèÈ°å„ÇíÊ∫ñÂÇô‰∏≠...</p>
        </div>

        <div class="quiz-container" id="quizContainer">
            <div class="quiz-header">
                <button class="back-to-top-btn" onclick="showConfirmModal()">‚Üê Êàª„Çã</button>
                <div class="question-counter" id="questionCounter">1 / 10</div>
            </div>
            
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="question">
                <div class="question-text" id="questionText"></div>
                <div class="reading-text" id="readingText"></div>
                
                <!-- Êõ∏„Åç„ÉÜ„Çπ„ÉàÁî®„ÅÆË°®Á§∫ -->
                <div id="writingSection" style="display: none;">
                    <div class="writing-display" id="writingDisplay"></div>
                    <div class="writing-instruction">„Åì„ÅÆË™≠„ÅøÊñπ„ÅÆÊº¢Â≠ó„ÇíÊõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    <div class="reading-text" id="writingHint" style="margin-top: 10px;"></div>
                    <button class="show-answer-btn" onclick="showAnswer()">Á≠î„Åà„ÇíË¶ã„Çã</button>
                    <div class="answer-display" id="answerDisplay"></div>
                    <div class="self-check-buttons">
                        <button class="check-btn correct" onclick="selfCheck(true)">
                            ‚≠ï Ê≠£Ëß£
                        </button>
                        <button class="check-btn incorrect" onclick="selfCheck(false)">
                            ‚ùå ‰∏çÊ≠£Ëß£
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="choices" id="choices"></div>
        </div>

        <div class="result" id="result">
            <h2>„ÇØ„Ç§„Ç∫ÁµÇ‰∫ÜÔºÅ</h2>
            <div class="score" id="score"></div>
            <button class="restart-btn" onclick="restart()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶</button>
            <button class="back-btn" onclick="backToMenu()">„É°„Éã„É•„Éº„Å´Êàª„Çã</button>
        </div>

        <!-- ÁÆ°ÁêÜÁîªÈù¢ -->
        <div class="admin-panel" id="adminPanel" style="display: none;">
            <div class="admin-header">
                <h2>üìù ÂïèÈ°åÁÆ°ÁêÜ</h2>
                <button class="close-admin-btn" onclick="hideAdminPanel()">‚úï</button>
            </div>
            
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="showAdminTab('add')">ÂïèÈ°åËøΩÂä†</button>
                <button class="admin-tab" onclick="showAdminTab('view')">ÂïèÈ°å‰∏ÄË¶ß</button>
                <button class="admin-tab" onclick="showAdminTab('import')">„Éá„Éº„ÇøÂèñËæº</button>
            </div>
            
            <!-- ÂïèÈ°åËøΩÂä†„Çø„Éñ -->
            <div class="admin-content" id="adminAdd">
                <div class="form-group">
                    <label>Â≠¶Âπ¥:</label>
                    <select id="addGrade">
                        <option value="1">1Âπ¥Áîü</option>
                        <option value="2">2Âπ¥Áîü</option>
                        <option value="3">3Âπ¥Áîü</option>
                        <option value="4">4Âπ¥Áîü</option>
                        <option value="5">5Âπ¥Áîü</option>
                        <option value="6">6Âπ¥Áîü</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Êº¢Â≠ó„ÉªÂçòË™û:</label>
                    <input type="text" id="addWord" placeholder="‰æã: Â±±">
                </div>
                
                <div class="form-group">
                    <label>Ë™≠„ÅøÊñπ:</label>
                    <input type="text" id="addReading" placeholder="‰æã: „ÇÑ„Åæ">
                </div>
                
                <div class="form-group">
                    <label>„Éí„É≥„Éà:</label>
                    <input type="text" id="addHint" placeholder="‰æã: È´ò„Åè„Å¶„ÅÆ„Åº„Çã„Å®„Åì„Çç">
                </div>
                
                <div class="form-group">
                    <label>ÂïèÈ°å„Çø„Ç§„Éó:</label>
                    <select id="addType">
                        <option value="both">Ë™≠„Åø„ÉªÊõ∏„Åç‰∏°Êñπ</option>
                        <option value="reading">Ë™≠„Åø„ÉÜ„Çπ„Éà„ÅÆ„Åø</option>
                        <option value="writing">Êõ∏„Åç„ÉÜ„Çπ„Éà„ÅÆ„Åø</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Èõ£ÊòìÂ∫¶:</label>
                    <select id="addDifficulty">
                        <option value="1">Á∞°Âçò</option>
                        <option value="2">ÊôÆÈÄö</option>
                        <option value="3">Èõ£„Åó„ÅÑ</option>
                    </select>
                </div>
                
                <button class="add-question-btn" onclick="addQuestion()">ÂïèÈ°å„ÇíËøΩÂä†</button>
                <div class="add-result" id="addResult"></div>
            </div>
            
            <!-- ÂïèÈ°å‰∏ÄË¶ß„Çø„Éñ -->
            <div class="admin-content" id="adminView" style="display: none;">
                <div class="form-group">
                    <label>Ë°®Á§∫Â≠¶Âπ¥:</label>
                    <select id="viewGrade" onchange="showQuestionList()">
                        <option value="1">1Âπ¥Áîü</option>
                        <option value="2">2Âπ¥Áîü</option>
                        <option value="3">3Âπ¥Áîü</option>
                        <option value="4">4Âπ¥Áîü</option>
                        <option value="5">5Âπ¥Áîü</option>
                        <option value="6">6Âπ¥Áîü</option>
                    </select>
                </div>
                <div class="question-list" id="questionList"></div>
            </div>
            
            <!-- „Éá„Éº„ÇøÂèñËæº„Çø„Éñ -->
            <div class="admin-content" id="adminImport" style="display: none;">
                <p>JSON„Éï„Ç°„Ç§„É´„Çí„ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢„Å´Ë≤º„Çä‰ªò„Åë„Å¶Âèñ„ÇäËæº„Åø„Åß„Åç„Åæ„Åô„ÄÇ</p>
                <div class="form-group">
                    <label>JSON„Éá„Éº„Çø:</label>
                    <textarea id="importData" rows="10" placeholder='{"grade": 1, "questions": [...]}'></textarea>
                </div>
                <button class="import-btn" onclick="importQuestions()">„Éá„Éº„Çø„ÇíÂèñ„ÇäËæº„ÇÄ</button>
                <div class="import-result" id="importResult"></div>
                
                <div class="export-section">
                    <h3>„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà</h3>
                    <div class="form-group">
                        <label>„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÂ≠¶Âπ¥:</label>
                        <select id="exportGrade">
                            <option value="1">1Âπ¥Áîü</option>
                            <option value="2">2Âπ¥Áîü</option>
                            <option value="3">3Âπ¥Áîü</option>
                            <option value="4">4Âπ¥Áîü</option>
                            <option value="5">5Âπ¥Áîü</option>
                            <option value="6">6Âπ¥Áîü</option>
                        </select>
                        <button class="export-btn" onclick="exportQuestions()">„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
                    </div>
                    <textarea id="exportData" rows="8" readonly placeholder="„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åï„Çå„ÅüJSON„Éá„Éº„Çø„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô"></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- „Ç´„Çπ„Çø„É†„É¢„Éº„ÉÄ„É´ -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <div class="modal-message" id="modalMessage"></div>
            <div class="modal-buttons">
                <button class="modal-btn ok" onclick="handleModalOK()">„ÅØ„ÅÑ</button>
                <button class="modal-btn cancel" onclick="hideModal()">„ÅÑ„ÅÑ„Åà</button>
            </div>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let kanjiDatabase = {};
        let currentGrade = null;
        let currentMode = null;
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let allKanjiByGrade = {};
        let modalCallback = null;
        
        // Èü≥Â£∞„Éï„Ç°„Ç§„É´
        let correctSound = new Audio('wav/correct.mp3');
        let wrongSound = new Audio('wav/wrong.mp3');
        let winSound = new Audio('wav/win.mp3');

        // „Ç´„Çπ„Çø„É†„É¢„Éº„ÉÄ„É´Ê©üËÉΩ
        function showModal(message, onOK, onCancel) {
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('modalOverlay').style.display = 'flex';
            modalCallback = { onOK, onCancel };
        }

        function hideModal() {
            document.getElementById('modalOverlay').style.display = 'none';
            if (modalCallback && modalCallback.onCancel) {
                modalCallback.onCancel();
            }
            modalCallback = null;
        }

        function handleModalOK() {
            document.getElementById('modalOverlay').style.display = 'none';
            if (modalCallback && modalCallback.onOK) {
                modalCallback.onOK();
            }
            modalCallback = null;
        }

        // Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
        function showConfirmModal() {
            showModal(
                '„ÇØ„Ç§„Ç∫„Çí‰∏≠Êñ≠„Åó„Å¶„Éà„ÉÉ„Éó„Å´Êàª„Çä„Åæ„Åô„ÅãÔºü\nÁèæÂú®„ÅÆÈÄ≤Êçó„ÅØÂ§±„Çè„Çå„Åæ„Åô„ÄÇ',
                function() { backToMenu(); },
                null
            );
        }

        // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
        function showErrorMessage(message) {
            showModal(
                message,
                function() { backToMenu(); },
                null
            );
        }

        // „Éà„ÉÉ„Éó„Å´Êàª„ÇãÔºà„Ç∞„É≠„Éº„Éê„É´„Çπ„Ç≥„Éº„ÉóÔºâ
        function backToMenu() {
            // „Åô„Åπ„Å¶„ÅÆÁîªÈù¢„ÇíÈùûË°®Á§∫
            document.getElementById('result').style.display = 'none';
            document.getElementById('loader').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('modeSelector').style.display = 'none';
            
            // Â≠¶Âπ¥ÈÅ∏ÊäûÁîªÈù¢„ÇíË°®Á§∫
            document.getElementById('gradeSelector').style.display = 'block';
            
            // „É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.grade-btn').forEach(function(btn) {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.mode-btn').forEach(function(btn) {
                btn.classList.remove('active');
            });
            
            currentGrade = null;
            currentMode = null;
            currentQuestions = [];
            currentQuestionIndex = 0;
            score = 0;
        }

        // Á≠î„Åà„ÇíË°®Á§∫Ôºà„Ç∞„É≠„Éº„Éê„É´„Çπ„Ç≥„Éº„ÉóÔºâ
        function showAnswer() {
            document.getElementById('answerDisplay').style.display = 'block';
        }
        
        // Ëá™Â∑±Êé°ÁÇπÔºà„Ç∞„É≠„Éº„Éê„É´„Çπ„Ç≥„Éº„ÉóÔºâ
        function selfCheck(isCorrect) {
            // „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
            document.querySelectorAll('.check-btn').forEach(function(btn) {
                btn.disabled = true;
            });
            
            if (isCorrect) {
                score++;
                correctSound.play();
            } else {
                wrongSound.play();
            }
            
            setTimeout(function() {
                currentQuestionIndex++;
                if (currentQuestionIndex < currentQuestions.length) {
                    showQuestion();
                } else {
                    showResult();
                }
            }, 1000);
        }
        
        // „É™„Çπ„Çø„Éº„ÉàÔºà„Ç∞„É≠„Éº„Éê„É´„Çπ„Ç≥„Éº„ÉóÔºâ
        function restart() {
            document.getElementById('result').style.display = 'none';
            document.getElementById('loader').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'none';
            
            currentQuestionIndex = 0;
            score = 0;
            
            startQuiz();
        }

        // ÂàùÊúüÂåñÊôÇ„Å´„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË®≠ÂÆö
        function initializeSampleData() {
            // 1Âπ¥Áîü„ÅÆ„Çµ„É≥„Éó„É´„Éá„Éº„Çø
            kanjiDatabase[1] = {
                grade: 1,
                kanjiList: ['‰∏Ä', 'Âè≥', 'Èõ®', 'ÂÜÜ', 'Áéã', 'Èü≥', '‰∏ã', 'ÁÅ´', 'Ëä±', 'Ë≤ù', 'Â≠¶', 'Ê∞ó', '‰πù', '‰ºë', 'Áéâ', 'Èáë', 'Á©∫', 'Êúà', 'Áä¨', 'Ë¶ã', '‰∫î', 'Âè£', 'Ê†°', 'Â∑¶', '‰∏â', 'Â±±', 'Â≠ê', 'Âõõ', 'Á≥∏', 'Â≠ó', 'ËÄ≥', '‰∏É', 'Ëªä', 'Êâã', 'ÂçÅ', 'Âá∫', 'Â•≥', 'Â∞è', '‰∏ä', 'Ê£Æ', '‰∫∫', 'Ê∞¥', 'Ê≠£', 'Áîü', 'Èùí', 'Â§ï', 'Áü≥', 'Ëµ§', 'ÂçÉ', 'Â∑ù', 'ÂÖà', 'Êó©', 'Ëçâ', 'Ë∂≥', 'Êùë', 'Â§ß', 'Áî∑', 'Á´π', '‰∏≠', 'Ëô´', 'Áî∫', 'Â§©', 'Áî∞', 'Âúü', '‰∫å', 'Êó•', 'ÂÖ•', 'Âπ¥', 'ÁôΩ', 'ÂÖ´', 'Áôæ', 'Êñá', 'Êú®', 'Êú¨', 'Âêç', 'ÁõÆ', 'Á´ã', 'Âäõ', 'Êûó', 'ÂÖ≠'],
                questions: [
                    { type: 'both', word: 'Â±±', reading: '„ÇÑ„Åæ', hint: 'È´ò„Åè„Å¶„ÅÆ„Åº„Çã„Å®„Åì„Çç', difficulty: 1 },
                    { type: 'both', word: 'Â∑ù', reading: '„Åã„Çè', hint: 'Ê∞¥„Åå„Å™„Åå„Çå„Å¶„ÅÑ„Çã„Å®„Åì„Çç', difficulty: 1 },
                    { type: 'both', word: 'Â≠¶Ê†°', reading: '„Åå„Å£„Åì„ÅÜ', hint: '„Åπ„Çì„Åç„Çá„ÅÜ„Çí„Åô„Çã„Å®„Åì„Çç', difficulty: 2 },
                    { type: 'both', word: 'ÂÖàÁîü', reading: '„Åõ„Çì„Åõ„ÅÑ', hint: '„Åπ„Çì„Åç„Çá„ÅÜ„ÇíÊïô„Åà„Å¶„Åè„Çå„Çã‰∫∫', difficulty: 2 },
                    { type: 'both', word: 'Êú¨', reading: '„Åª„Çì', hint: '„Çà„ÇÄ„ÇÇ„ÅÆ„ÄÅ„Éö„Éº„Ç∏„Åå„ÅÇ„Çã„ÇÇ„ÅÆ', difficulty: 1 },
                    { type: 'both', word: 'Êó•', reading: '„Å≤', hint: '„Åü„ÅÑ„Çà„ÅÜ„ÄÅ„ÅÇ„Åï„ÅÆ„Åº„Çã', difficulty: 1 },
                    { type: 'both', word: 'Êúà', reading: '„Å§„Åç', hint: '„Çà„Çã„Å´Ë¶ã„Åà„Çã„ÄÅ„Åæ„Çã„ÅÑ„ÇÇ„ÅÆ', difficulty: 1 },
                    { type: 'both', word: '‰∫∫', reading: '„Å≤„Å®', hint: '„Çè„Åü„Åó„Åü„Å°„ÅÆ„Åì„Å®', difficulty: 1 },
                    { type: 'both', word: 'ÁÅ´', reading: '„Å≤', hint: '„ÅÇ„Å§„Åè„Å¶Ëµ§„ÅÑ„ÄÅ„ÇÇ„Åà„Çã„ÇÇ„ÅÆ', difficulty: 1 },
                    { type: 'both', word: 'Ê∞¥', reading: '„Åø„Åö', hint: '„ÅÆ„ÇÄ„ÇÇ„ÅÆ„ÄÅ„Åï„Çâ„Åï„Çâ„Åó„Å¶„Çã', difficulty: 1 },
                    { type: 'both', word: 'Êú®', reading: '„Åç', hint: '„ÅØ„Å£„Å±„Åå„ÅÇ„Çã„ÄÅ„Åø„Å©„Çä„ÅÆ„ÇÇ„ÅÆ', difficulty: 1 },
                    { type: 'both', word: 'Èáë', reading: '„Åç„Çì', hint: '„Åç„ÅÑ„Çç„Åè„Å¶„ÄÅ„Åä„Åã„Å≠„Å´„Å™„Çã', difficulty: 1 },
                    { type: 'both', word: 'Âúü', reading: '„Å§„Å°', hint: '„Åò„ÇÅ„Çì„Å´„ÅÇ„Çã„ÄÅ„Åè„Çç„ÅÑ„ÇÇ„ÅÆ', difficulty: 1 },
                    { type: 'both', word: 'Á©∫', reading: '„Åù„Çâ', hint: '„ÅÜ„Åà„ÇíË¶ã„Çã„Å®„ÄÅ„ÅÇ„Åä„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'Èõ®', reading: '„ÅÇ„ÇÅ', hint: '„Åù„Çâ„Åã„Çâ„Åµ„Å£„Å¶„Åè„ÇãÊ∞¥', difficulty: 1 },
                    { type: 'both', word: 'Áü≥', reading: '„ÅÑ„Åó', hint: '„Åã„Åü„Åè„Å¶„ÄÅ„Åò„ÇÅ„Çì„Å´„ÅÇ„Çã', difficulty: 1 },
                    { type: 'both', word: 'Ëä±', reading: '„ÅØ„Å™', hint: '„Åç„Çå„ÅÑ„Åß„ÄÅ„ÅÑ„ÅÑ„Å´„Åä„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'Ëçâ', reading: '„Åè„Åï', hint: '„Åø„Å©„Çä„Åß„ÄÅ„Åò„ÇÅ„Çì„Å´„ÅØ„Åà„Çã', difficulty: 1 },
                    { type: 'both', word: 'Áä¨', reading: '„ÅÑ„Å¨', hint: '„ÉØ„É≥„ÉØ„É≥„Å®„Å™„Åè„ÄÅ„Éö„ÉÉ„Éà', difficulty: 1 },
                    { type: 'both', word: 'Ëªä', reading: '„Åè„Çã„Åæ', hint: '„Çø„Ç§„É§„Åå„ÅÇ„Çã„ÄÅ„ÅÆ„Çä„ÇÇ„ÅÆ', difficulty: 1 }
                ]
            };

            // 2Âπ¥Áîü„ÅÆ„Çµ„É≥„Éó„É´„Éá„Éº„Çø
            kanjiDatabase[2] = {
                grade: 2,
                kanjiList: ['Âºï', 'ÁæΩ', 'Èõ≤', 'Âúí', 'ÈÅ†', '‰Ωï', 'Áßë', 'Â§è', 'ÂÆ∂', 'Ê≠å', 'Áîª', 'Âõû', '‰ºö', 'Êµ∑', 'Áµµ', 'Â§ñ', 'Ëßí', 'Ê•Ω', 'Ê¥ª', 'Èñì', '‰∏∏', 'Â≤©', 'È°î', 'Ê±Ω', 'Ë®ò', 'Â∏∞', 'Âºì', 'Áâõ', 'È≠ö', '‰∫¨', 'Âº∑', 'Êïô', 'Ëøë', 'ÂÖÑ', 'ÂΩ¢', 'Ë®à', 'ÂÖÉ', 'Ë®Ä', 'Âéü', 'Êà∏', 'Âè§', 'Âçà', 'Âæå', 'Ë™û', 'Â∑•', 'ÂÖ¨', 'Â∫É', '‰∫§', 'ÂÖâ', 'ËÄÉ', 'Ë°å', 'È´ò', 'ÈªÑ', 'Âêà', 'Ë∞∑', 'ÂõΩ', 'Èªí', '‰ªä', 'Êâç', 'Á¥∞', '‰Ωú', 'ÁÆó', 'Ê≠¢', 'Â∏Ç', 'Áü¢', 'Âßâ', 'ÊÄù', 'Á¥ô', 'ÂØ∫', 'Ëá™', 'ÊôÇ', 'ÂÆ§', 'Á§æ', 'Âº±', 'È¶ñ', 'Áßã', 'ÈÄ±', 'Êò•', 'Êõ∏', 'Â∞ë', 'Â†¥', 'Ëâ≤', 'È£ü', 'ÂøÉ', 'Êñ∞', 'Ë¶™', 'Âõ≥', 'Êï∞', 'Ë•ø', 'Â£∞', 'Êòü', 'Êô¥', 'Âàá', 'Èõ™', 'Ëàπ', 'Á∑ö', 'Ââç', 'ÁµÑ', 'Ëµ∞', 'Â§ö', 'Â§™', '‰Ωì', 'Âè∞', 'Âú∞', 'Ê±†', 'Áü•', 'Ëå∂', 'Êòº', 'Èï∑', 'È≥•', 'Êúù', 'Áõ¥', 'ÈÄö', 'Âºü', 'Â∫ó', 'ÁÇπ', 'Èõª', 'ÂàÄ', 'ÂÜ¨', 'ÂΩì', 'Êù±', 'Á≠î', 'È†≠', 'Âêå', 'ÈÅì', 'Ë™≠', 'ÂÜÖ', 'Âçó', 'ËÇâ', 'È¶¨', 'Â£≤', 'Ë≤∑', 'È∫¶', 'Âçä', 'Áï™', 'Áà∂', 'È¢®', 'ÂàÜ', 'ËÅû', 'Á±≥', 'Ê≠©', 'ÊØç', 'Êñπ', 'Âåó', 'ÊØé', 'Â¶π', '‰∏á', 'Êòé', 'È≥¥', 'ÊØõ', 'ÈñÄ', 'Â§ú', 'Èáé', 'Âèã', 'Áî®', 'Êõú', 'Êù•', 'Èáå', 'ÁêÜ', 'Ë©±'],
                questions: [
                    { type: 'both', word: 'ÊïôÂÆ§', reading: '„Åç„Çá„ÅÜ„Åó„Å§', hint: '„Åò„ÇÖ„Åé„Çá„ÅÜ„Çí„ÅÜ„Åë„ÇãÈÉ®Â±ã', difficulty: 2 },
                    { type: 'both', word: 'Âèã„Å†„Å°', reading: '„Å®„ÇÇ„Å†„Å°', hint: '„ÅÑ„Å£„Åó„Çá„Å´„ÅÇ„Åù„Å∂„ÄÅ„Å™„Åã„Çà„Åó„ÅÆ‰∫∫', difficulty: 1 },
                    { type: 'both', word: 'Â§è‰ºë„Åø', reading: '„Å™„Å§„ÇÑ„Åô„Åø', hint: '„ÅÇ„Å§„ÅÑÊôÇ„ÅÆ„Å™„Åå„ÅÑ„Åä„ÇÑ„Åô„Åø', difficulty: 2 },
                    { type: 'both', word: 'Êò•', reading: '„ÅØ„Çã', hint: '„Åï„Åè„Çâ„Åå„Åï„Åè„ÄÅ„ÅÇ„Åü„Åü„Åã„ÅÑ„Åç„Åõ„Å§', difficulty: 1 },
                    { type: 'both', word: 'È¢®', reading: '„Åã„Åú', hint: '„Åù„Çâ„Åã„Çâ„Åµ„ÅÑ„Å¶„Åè„Çã„ÄÅ„Åç„ÇÇ„Å°„ÅÑ„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'Èõ®', reading: '„ÅÇ„ÇÅ', hint: '„Åù„Çâ„Åã„Çâ„Åµ„Å£„Å¶„Åè„ÇãÊ∞¥„ÄÅ„Åã„Åï„Çí„Åï„Åô', difficulty: 1 },
                    { type: 'both', word: 'Èõ™', reading: '„ÇÜ„Åç', hint: '„Åµ„ÇÜ„Å´„Åµ„Çã„ÄÅ„Åó„Çç„Åè„Å¶„Å§„ÇÅ„Åü„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'ÈõªËªä', reading: '„Åß„Çì„Åó„ÇÉ', hint: '„É¨„Éº„É´„ÅÆ„ÅÜ„Åà„Çí„ÅØ„Åó„Çã„ÄÅ„Åà„Åç„Å´„Åè„Çã', difficulty: 2 },
                    { type: 'both', word: 'Êñ∞„Åó„ÅÑ', reading: '„ÅÇ„Åü„Çâ„Åó„ÅÑ', hint: '„Åç„ÅÆ„ÅÜ„Åã„Å£„Åü„ÄÅ„Éî„Ç´„Éî„Ç´„ÅÆ', difficulty: 2 },
                    { type: 'both', word: 'Âè§„ÅÑ', reading: '„Åµ„Çã„ÅÑ', hint: '„Åö„Å£„Å®„Åæ„Åà„Åã„Çâ„ÅÇ„Çã„ÄÅ„Åä„Åò„ÅÑ„Å°„ÇÉ„Çì„ÅÆ', difficulty: 1 },
                    { type: 'both', word: 'Êòé„Çã„ÅÑ', reading: '„ÅÇ„Åã„Çã„ÅÑ', hint: '„Å≤„Åã„Çä„Åå„Åü„Åè„Åï„Çì„ÄÅ„Çà„ÅèË¶ã„Åà„Çã', difficulty: 2 },
                    { type: 'both', word: 'Êöó„ÅÑ', reading: '„Åè„Çâ„ÅÑ', hint: '„Å≤„Åã„Çä„Åå„Å™„ÅÑ„ÄÅ„Çà„ÇãË¶ã„Åà„Å™„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'Èï∑„ÅÑ', reading: '„Å™„Åå„ÅÑ', hint: '„ÅØ„Åó„Åã„Çâ„ÅØ„Åó„Åæ„Åß„Å®„Åä„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'Áü≠„ÅÑ', reading: '„Åø„Åò„Åã„ÅÑ', hint: '„Åô„Åê„Åä„Çè„Çã„ÄÅ„Å°„ÅÑ„Åï„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'Âº∑„ÅÑ', reading: '„Å§„Çà„ÅÑ', hint: '„Å°„Åã„Çâ„Åå„ÅÇ„Çã„ÄÅ„Åæ„Åë„Å™„ÅÑ', difficulty: 1 }
                ]
            };

            // 3Âπ¥Áîü„ÅÆ„Éá„Éº„Çø
            kanjiDatabase[3] = {
                grade: 3,
                kanjiList: ["ÊÇ™", "ÂÆâ", "Êöó", "Âåª", "Âßî", "ÊÑè", "ËÇ≤", "Âì°", "Èô¢", "È£≤", "ÈÅã", "Ê≥≥", "ÈßÖ", "Â§Æ", "Ê®™", "Â±ã", "Ê∏©", "Âåñ", "Ëç∑", "Áïå", "Èñã", "Èöé", "ÂØí", "ÊÑü", "Êº¢", "È§®", "Â≤∏", "Ëµ∑", "Êúü", "ÂÆ¢", "Á©∂", "ÊÄ•", "Á¥ö", "ÂÆÆ", "ÁêÉ", "Âéª", "Ê©ã", "Ê•≠", "Êõ≤", "Â±Ä", "ÈäÄ", "Âå∫", "Ëã¶", "ÂÖ∑", "Âêõ", "‰øÇ", "ËªΩ", "Ë°Ä", "Ê±∫", "Á†î", "Áúå", "Â∫´", "Êπñ", "Âêë", "Âπ∏", "Ê∏Ø", "Âè∑", "Ê†π", "Á•≠", "Áöø", "‰ªï", "Ê≠ª", "‰Ωø", "Âßã", "Êåá", "Ê≠Ø", "Ë©©", "Ê¨°", "‰∫ã", "ÊåÅ", "Âºè", "ÂÆü", "ÂÜô", "ËÄÖ", "‰∏ª", "ÂÆà", "Âèñ", "ÈÖí", "Âèó", "Â∑û", "Êãæ", "ÁµÇ", "Áøí", "ÈõÜ", "‰Ωè", "Èáç", "ÂÆø", "ÊâÄ", "Êöë", "Âä©", "Êò≠", "Ê∂à", "ÂïÜ", "Á´†", "Âãù", "‰πó", "Ê§ç", "Áî≥", "Ë∫´", "Á•û", "Áúü", "Ê∑±", "ÈÄ≤", "‰∏ñ", "Êï¥", "Êòî", "ÂÖ®", "Áõ∏", "ÈÄÅ", "ÊÉ≥", "ÊÅØ", "ÈÄü", "Êóè", "‰ªñ", "Êâì", "ÂØæ", "ÂæÖ", "‰ª£", "Á¨¨", "È°å", "ÁÇ≠", "Áü≠", "Ë´á", "ÁùÄ", "Ê≥®", "Êü±", "‰∏Å", "Â∏≥", "Ë™ø", "ËøΩ", "ÂÆö", "Â∫≠", "Á¨õ", "ÈâÑ", "Ëª¢", "ÈÉΩ", "Â∫¶", "Êäï", "Ë±Ü", "Â≥∂", "ÊπØ", "Áôª", "Á≠â", "Âãï", "Á´•", "Ëæ≤", "Ê≥¢", "ÈÖç", "ÂÄç", "Áïë", "Áô∫", "Âèç", "ÂùÇ", "Êùø", "ÁöÆ", "ÊÇ≤", "Áæé", "Èºª", "Á≠Ü", "Ê∞∑", "Ë°®", "Áßí", "ÁóÖ", "ÂìÅ", "Ë≤†", "ÈÉ®", "Êúç", "Á¶è", "Áâ©", "Âπ≥", "Ëøî", "Âãâ", "Êîæ", "Âë≥", "ÂëΩ", "Èù¢", "Âïè", "ÂΩπ", "Ëñ¨", "Áî±", "Ê≤π", "Êúâ", "ÈÅä", "‰∫à", "Áæä", "Ê¥ã", "Ëëâ", "ÈôΩ", "Êßò", "ËêΩ", "ÊµÅ", "ÊóÖ", "‰∏°", "Á∑ë", "Á§º", "Âàó", "Á∑¥", "Ë∑Ø", "Âíå"],
                questions: [
                    { type: 'both', word: 'ÂÆøÈ°å', reading: '„Åó„ÇÖ„Åè„Å†„ÅÑ', hint: 'Â≠¶Ê†°„ÅßÂá∫„Åï„Çå„Çã„ÄÅÂÆ∂„Åß„ÇÑ„Çã„Åπ„Çì„Åç„Çá„ÅÜ', difficulty: 2 },
                    { type: 'both', word: 'ÂßîÂì°', reading: '„ÅÑ„ÅÑ„Çì', hint: '„ÇØ„É©„Çπ„ÅÆ„Åø„Çì„Å™„ÅÆ„Åü„ÇÅ„Å´„Åä‰ªï‰∫ã„Çí„Åô„Çã‰∫∫', difficulty: 2 },
                    { type: 'both', word: 'Âõ≥Êõ∏È§®', reading: '„Å®„Åó„Çá„Åã„Çì', hint: 'Êú¨„Åå„Åü„Åè„Åï„Çì„ÅÇ„Çã„ÄÅ„Åπ„Çì„Åç„Çá„ÅÜ„ÇÑË™≠Êõ∏„Çí„Åô„ÇãÂª∫Áâ©', difficulty: 2 },
                    { type: 'both', word: 'ÈÅãÂãï', reading: '„ÅÜ„Çì„Å©„ÅÜ', hint: '‰Ωì„ÇíÂãï„Åã„Åô„Åì„Å®„ÄÅËµ∞„Å£„Åü„ÇäË∑≥„Çì„Å†„Çä„Åô„Çã', difficulty: 2 },
                    { type: 'both', word: 'Ê≥≥„Åê', reading: '„Åä„Çà„Åê', hint: 'Ê∞¥„ÅÆ‰∏≠„ÇíÈÄ≤„ÇÄ„ÄÅ„Éó„Éº„É´„ÇÑÊµ∑„Åß„Åô„Çã', difficulty: 1 },
                    { type: 'both', word: 'ÈßÖ', reading: '„Åà„Åç', hint: 'ÈõªËªä„Å´‰πó„ÇãÂ†¥ÊâÄ„ÄÅÂàáÁ¨¶„ÇíË≤∑„ÅÜ„Å®„Åì„Çç', difficulty: 1 },
                    { type: 'both', word: 'Ê∏©Â∫¶', reading: '„Åä„Çì„Å©', hint: '„ÅÇ„Å§„Åï„ÇÑ„Åï„ÇÄ„Åï„ÇíÊï∞Â≠ó„ÅßË°®„Åó„Åü„ÇÇ„ÅÆ', difficulty: 2 },
                    { type: 'both', word: 'ÈñãÂßã', reading: '„Åã„ÅÑ„Åó', hint: 'Âßã„Åæ„Çã„Åì„Å®„ÄÅ„Çπ„Çø„Éº„Éà„Åô„Çã„Åì„Å®', difficulty: 2 },
                    { type: 'both', word: 'ÈöéÊÆµ', reading: '„Åã„ÅÑ„Å†„Çì', hint: '‰∏ä„ÅÆÈöé„Å´‰∏ä„Åå„Çã„ÄÅÊÆµ„Å´„Å™„Å£„Å¶„ÅÑ„ÇãÈÅì', difficulty: 2 },
                    { type: 'both', word: 'ÂØí„ÅÑ', reading: '„Åï„ÇÄ„ÅÑ', hint: 'ÂÜ¨„ÅÆÂ§ñ„ÅÆ„Çà„ÅÜ„Åô„ÄÅ„Ç≥„Éº„Éà„ÅåÂøÖË¶Å„Å™Â§©Ê∞ó', difficulty: 1 },
                    { type: 'both', word: 'ÊÑü„Åò„Çã', reading: '„Åã„Çì„Åò„Çã', hint: 'ÂøÉ„ÇÑ‰Ωì„Åß‰Ωï„Åã„ÇíÁü•„Çã„ÄÅÊ∞óÊåÅ„Å°„ÇíÊåÅ„Å§', difficulty: 2 },
                    { type: 'both', word: 'Êº¢Â≠ó', reading: '„Åã„Çì„Åò', hint: '‰∏≠ÂõΩ„Åã„ÇâÊù•„ÅüÊñáÂ≠ó„ÄÅ‰ªä„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Å¶„ÅÑ„ÇãÂ≠ó', difficulty: 2 },
                    { type: 'both', word: 'Â≤∏', reading: '„Åç„Åó', hint: 'Êµ∑„ÇÑÂ∑ù„ÅÆ„ÅØ„Åò„Å£„Åì„ÄÅÊ∞¥Èöõ„ÅÆ„Å®„Åì„Çç', difficulty: 1 },
                    { type: 'both', word: 'Ëµ∑„Åç„Çã', reading: '„Åä„Åç„Çã', hint: 'Êúù„Éô„ÉÉ„Éâ„Åã„ÇâÂá∫„Çã„ÄÅÁú†„Çä„Åã„ÇâÁõÆË¶ö„ÇÅ„Çã', difficulty: 1 },
                    { type: 'both', word: 'ÊúüÈñì', reading: '„Åç„Åã„Çì', hint: 'Âßã„Åæ„Çä„Åã„ÇâÁµÇ„Çè„Çä„Åæ„Åß„ÅÆÊôÇÈñì', difficulty: 2 },
                    { type: 'both', word: 'ÊÄ•„Åê', reading: '„ÅÑ„Åù„Åê', hint: 'ÈÄü„ÅèË°åÂãï„Åô„Çã„ÄÅÈÅÖÂàª„Åó„Åù„ÅÜ„Å™„Å®„Åç„Å´„Åô„Çã', difficulty: 1 },
                    { type: 'both', word: 'Á¥ö', reading: '„Åç„ÇÖ„ÅÜ', hint: 'ÊÆµÈöé„ÇÑÁ≠âÁ¥ö„ÄÅÊº¢Â≠ó„Åë„Çì„Å¶„ÅÑ„ÅÆ‚óãÁ¥ö', difficulty: 1 },
                    { type: 'both', word: 'ÁêÉ', reading: '„Åç„ÇÖ„ÅÜ', hint: '„Åæ„Çì‰∏∏„Å™ÂΩ¢„ÄÅÈáéÁêÉ„ÇÑ„Çµ„ÉÉ„Ç´„Éº„Éú„Éº„É´', difficulty: 1 },
                    { type: 'both', word: 'Ê©ã', reading: '„ÅØ„Åó', hint: 'Â∑ù„ÇÑÈÅìË∑Ø„ÅÆ‰∏ä„ÇíÊ∏°„Çã„ÄÅ„Å§„Å™„Åê„ÇÇ„ÅÆ', difficulty: 1 },
                    { type: 'both', word: 'Êõ≤', reading: '„Åç„Çá„Åè', hint: 'Èü≥Ê•Ω„ÅÆÊ≠å„ÄÅ„É°„É≠„Éá„Ç£„Éº„Åå„ÅÇ„Çã„ÇÇ„ÅÆ', difficulty: 1 },
                    { type: 'both', word: 'ÈäÄË°å', reading: '„Åé„Çì„Åì„ÅÜ', hint: '„ÅäÈáë„ÇíÈ†ê„Åë„ÇãÂª∫Áâ©„ÄÅATM„Åå„ÅÇ„ÇãÂ†¥ÊâÄ', difficulty: 2 },
                    { type: 'both', word: 'Ëã¶„Åó„ÅÑ', reading: '„Åè„Çã„Åó„ÅÑ', hint: 'Ëæõ„ÅÑ„ÄÅÂõ∞„Å£„Å¶„ÅÑ„Çã„ÄÅÂ§ßÂ§â„Å™Áä∂ÊÖã', difficulty: 1 },
                    { type: 'both', word: 'ÈÅìÂÖ∑', reading: '„Å©„ÅÜ„Åê', hint: '‰Ωï„Åã„Çí„Åô„Çã„Å®„Åç„Å´‰Ωø„ÅÜ„ÇÇ„ÅÆ„ÄÅÂ∑•ÂÖ∑„ÇÑÁî®ÂÖ∑', difficulty: 1 },
                    { type: 'both', word: 'Âêõ', reading: '„Åç„Åø', hint: 'ÂèãÈÅî„ÇíÂëº„Å∂„Å®„Åç„ÄÅÁî∑„ÅÆÂ≠ê„Å´‰Ωø„ÅÜË®ÄËëâ', difficulty: 1 },
                    { type: 'both', word: '‰øÇ', reading: '„Åã„Åã„Çä', hint: '„ÇØ„É©„Çπ„ÅÆ‰ªï‰∫ã„Çí„Åô„Çã‰∫∫„ÄÅÁµ¶È£ü‰øÇ„Å™„Å©', difficulty: 1 },
                    { type: 'both', word: 'ËªΩ„ÅÑ', reading: '„Åã„Çã„ÅÑ', hint: 'Èáç„Åè„Å™„ÅÑ„ÄÅÊåÅ„Å°‰∏ä„Åí„ÇÑ„Åô„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'Ë°Ä', reading: '„Å°', hint: '‰Ωì„ÅÆ‰∏≠„ÇíÊµÅ„Çå„ÇãËµ§„ÅÑÊ∂≤‰Ωì', difficulty: 1 },
                    { type: 'both', word: 'Ê±∫„ÇÅ„Çã', reading: '„Åç„ÇÅ„Çã', hint: 'ÈÅ∏„Å∂„ÄÅ„ÅØ„Å£„Åç„Çä„Åï„Åõ„Çã', difficulty: 1 },
                    { type: 'both', word: 'Áúå', reading: '„Åë„Çì', hint: 'Êó•Êú¨„ÅÆ47„ÅÆÂú∞Âüü„ÄÅ‚óã‚óãÁúå', difficulty: 1 },
                    { type: 'both', word: 'Êπñ', reading: '„Åø„Åö„ÅÜ„Åø', hint: 'Â±±„Å´Âõ≤„Åæ„Çå„ÅüÂ§ß„Åç„Å™Ê∞¥„ÄÅ„Å≥„ÇèÊπñ„Å™„Å©', difficulty: 1 }
                ]
            };

            // 4Âπ¥Áîü„ÅÆ„Éá„Éº„Çø
            kanjiDatabase[4] = {
                grade: 4,
                kanjiList: ["ÊÑõ", "Ê°à", "‰ª•", "Ë°£", "‰Ωç", "Ëå®", "Âç∞", "Ëã±", "Ê†Ñ", "Â™õ", "Â°©", "Â≤°", "ÂÑÑ", "Âä†", "Êûú", "Ë≤®", "Ë™≤", "ËäΩ", "Ë≥Ä", "Êîπ", "Ê¢∞", "ÂÆ≥", "Ë°ó", "ÂêÑ", "Ë¶ö", "ÊΩü", "ÂÆå", "ÂÆò", "ÁÆ°", "Èñ¢", "Ë¶≥", "È°ò", "Â≤ê", "Â∏å", "Â≠£", "Êóó", "Âô®", "Ê©ü", "Ë≠∞", "Ê±Ç", "Ê≥£", "Áµ¶", "Êåô", "ÊºÅ", "ÂÖ±", "Âçî", "Èè°", "Á´∂", "Ê•µ", "ÁÜä", "Ë®ì", "Ëªç", "ÈÉ°", "Áæ§", "ÂæÑ", "ÊôØ", "Ëä∏", "Ê¨†", "Áµê", "Âª∫", "ÂÅ•", "È®ì", "Âõ∫", "Âäü", "Â•Ω", "È¶ô", "ÂÄô", "Â∫∑", "‰Ωê", "Â∑Æ", "Ëèú", "ÊúÄ", "Âüº", "Êùê", "Â¥é", "Êò®", "Êú≠", "Âà∑", "ÂØü", "ÂèÇ", "Áî£", "Êï£", "ÊÆã", "Ê∞è", "Âè∏", "Ë©¶", "ÂÖê", "Ê≤ª", "Êªã", "Ëæû", "Èπø", "Â§±", "ÂÄü", "Á®Æ", "Âë®", "Á•ù", "È†Ü", "Âàù", "Êùæ", "Á¨ë", "Âî±", "ÁÑº", "ÁÖß", "Âüé", "Á∏Ñ", "Ëá£", "‰ø°", "‰∫ï", "Êàê", "ÁúÅ", "Ê∏Ö", "Èùô", "Â∏≠", "Á©ç", "Êäò", "ÁØÄ", "Ë™¨", "ÊµÖ", "Êà¶", "ÈÅ∏", "ÁÑ∂", "‰∫â", "ÂÄâ", "Â∑£", "Êùü", "ÂÅ¥", "Á∂ö", "Âçí", "Â≠´", "Â∏Ø", "Èöä", "ÈÅî", "Âçò", "ÁΩÆ", "‰ª≤", "Ê≤ñ", "ÂÖÜ", "‰Ωé", "Â∫ï", "ÁöÑ", "ÂÖ∏", "‰ºù", "Âæí", "Âä™", "ÁÅØ", "ÂÉç", "Áâπ", "Âæ≥", "Ê†É", "Â•à", "Ê¢®", "ÁÜ±", "Âøµ", "Êïó", "Ê¢Ö", "Âçö", "Èò™", "È£Ø", "È£õ", "ÂøÖ", "Á•®", "Ê®ô", "‰∏ç", "Â§´", "‰ªò", "Â∫ú", "Èòú", "ÂØå", "ÂâØ", "ÂÖµ", "Âà•", "Ëæ∫", "Â§â", "‰æø", "ÂåÖ", "Ê≥ï", "Êúõ", "Áâß", "Êú´", "Ê∫Ä", "Êú™", "Ê∞ë", "ÁÑ°", "Á¥Ñ", "Âãá", "Ë¶Å", "È§ä", "Êµ¥", "Âà©", "Èô∏", "ËâØ", "Êñô", "Èáè", "Ëº™", "È°û", "‰ª§", "ÂÜ∑", "‰æã", "ÈÄ£", "ËÄÅ", "Âä¥", "Èå≤"],
                questions: [
                    { type: 'both', word: 'ÊÑõÊÉÖ', reading: '„ÅÇ„ÅÑ„Åò„Çá„ÅÜ', hint: 'ÂÆ∂Êóè„ÇÑÂèã„Å†„Å°„ÇíÂ§ßÂàá„Å´ÊÄù„ÅÜÊ∞óÊåÅ„Å°', difficulty: 2 },
                    { type: 'both', word: 'Ê°àÂÜÖ', reading: '„ÅÇ„Çì„Å™„ÅÑ', hint: 'ÈÅì„ÇíÊïô„Åà„Çã„ÄÅÂ†¥ÊâÄ„ÇíË™¨Êòé„Åô„Çã', difficulty: 2 },
                    { type: 'both', word: '‰ª•‰∏ä', reading: '„ÅÑ„Åò„Çá„ÅÜ', hint: '„Åù„Çå„Çà„ÇäÂ§ö„ÅÑ„ÄÅ„Åù„Çå„ÇíÂê´„Çì„Åß‰∏ä', difficulty: 2 },
                    { type: 'both', word: 'Ë°£Êúç', reading: '„ÅÑ„Åµ„Åè', hint: 'ÁùÄ„ÇãÁâ©„ÄÅÊ¥ãÊúç„ÇÑÂíåÊúç', difficulty: 2 },
                    { type: 'both', word: '‰ΩçÁΩÆ', reading: '„ÅÑ„Å°', hint: 'Áâ©„Åå„ÅÇ„ÇãÂ†¥ÊâÄ„ÄÅ‰ΩçÁΩÆÈñ¢‰øÇ', difficulty: 2 },
                    { type: 'both', word: 'Âõ≤„ÇÄ', reading: '„Åã„Åì„ÇÄ', hint: 'Âë®„Çä„ÇíÂèñ„ÇäÂõ≤„ÇÄ„ÄÅ„Åø„Çì„Å™„ÅßËº™„Å´„Å™„Çã', difficulty: 1 },
                    { type: 'both', word: 'Âç∞Ë±°', reading: '„ÅÑ„Çì„Åó„Çá„ÅÜ', hint: 'ÂøÉ„Å´ÊÆã„ÇãÊÑü„Åò„ÄÅÁ¨¨‰∏ÄÂç∞Ë±°', difficulty: 2 },
                    { type: 'both', word: 'Ëã±Ë™û', reading: '„Åà„ÅÑ„Åî', hint: 'Â§ñÂõΩ„ÅÆË®ÄËëâ„ÄÅHello, Thank you', difficulty: 1 },
                    { type: 'both', word: '„Åà„ÅÑ„Çà„ÅÜ', reading: '„Åà„ÅÑ„Çà„ÅÜ', hint: '‰Ωì„ÇíÂÖÉÊ∞ó„Å´„Åô„Çã„ÄÅÈ£ü„ÅπÁâ©„ÅÆÂäõ', difficulty: 2 },
                    { type: 'both', word: 'Â°©', reading: '„Åó„Åä', hint: 'Êµ∑Ê∞¥„Åã„Çâ‰Ωú„ÇãÁôΩ„ÅÑË™øÂë≥Êñô„ÄÅ„Åó„Çá„Å£„Å±„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'ÂÑÑ', reading: '„Åä„Åè', hint: '„Å®„Å¶„ÇÇÂ§ß„Åç„Å™Êï∞„ÄÅ100,000,000', difficulty: 1 },
                    { type: 'both', word: 'Âä†„Åà„Çã', reading: '„Åè„Çè„Åà„Çã', hint: 'Êñ∞„Åó„Åè‰ªò„ÅëË∂≥„Åô„ÄÅ‰ª≤Èñì„Å´Âä†„Åà„Çã', difficulty: 1 },
                    { type: 'both', word: 'ÊûúÁâ©', reading: '„Åè„Å†„ÇÇ„ÅÆ', hint: '„Çä„Çì„Åî„ÇÑ„Åø„Åã„Çì„ÄÅÁîò„ÅÑÈ£ü„ÅπÁâ©', difficulty: 1 },
                    { type: 'both', word: 'Ë™≤È°å', reading: '„Åã„Å†„ÅÑ', hint: '„ÇÑ„Çâ„Å™„Åë„Çå„Å∞„ÅÑ„Åë„Å™„ÅÑ„Åπ„Çì„Åç„Çá„ÅÜ„ÇÑ‰ªï‰∫ã', difficulty: 2 },
                    { type: 'both', word: 'ËäΩ', reading: '„ÇÅ', hint: '„Åó„Çá„Åè„Å∂„Å§„ÅÆÊñ∞„Åó„ÅÑÈÉ®ÂàÜ„ÄÅÊò•„Å´Âá∫„Å¶„Åè„Çã', difficulty: 1 },
                    { type: 'both', word: '„Åã„ÅÑ„Çä„Çá„ÅÜ', reading: '„Åã„ÅÑ„Çä„Çá„ÅÜ', hint: '„ÇÇ„Å£„Å®ËâØ„Åè„Åô„Çã„ÄÅÁõ¥„Åó„Å¶ËâØ„Åè„Åô„Çã', difficulty: 2 },
                    { type: 'both', word: '„Åç„Åã„ÅÑ', reading: '„Åç„Åã„ÅÑ', hint: '‰∫∫„ÅÆ‰ª£„Çè„Çä„Å´ÂÉç„ÅèÈÅìÂÖ∑„ÄÅ„É≠„Éú„ÉÉ„Éà„Å™„Å©', difficulty: 2 },
                    { type: 'both', word: 'ÂêÑËá™', reading: '„Åã„Åè„Åò', hint: '‰∏Ä‰∫∫‰∏Ä‰∫∫„ÄÅ„Åù„Çå„Åû„Çå„ÅÆ‰∫∫', difficulty: 2 },
                    { type: 'both', word: 'Ë¶ö„Åà„Çã', reading: '„Åä„Åº„Åà„Çã', hint: 'È†≠„Å´ÂÖ•„Çå„Çã„ÄÅ„Åç„Åä„Åè„Åô„Çã', difficulty: 1 },
                    { type: 'both', word: '„Åã„Çì„Åõ„ÅÑ', reading: '„Åã„Çì„Åõ„ÅÑ', hint: 'ÊúÄÂæå„Åæ„Åß‰Ωú„Çä‰∏ä„Åí„Çã„ÄÅ„Åã„Çì„Åú„Çì„Å´Âá∫Êù•‰∏ä„Åå„Çã', difficulty: 2 },
                    { type: 'both', word: '„Åã„Çì„Çä', reading: '„Åã„Çì„Çä', hint: '„Åç„Å°„Çì„Å®‰∏ñË©±„Çí„Åô„Çã„ÄÅ„Åõ„Åç„Å´„Çì„ÇíÊåÅ„Å§', difficulty: 2 },
                    { type: 'both', word: 'Èñ¢‰øÇ', reading: '„Åã„Çì„Åë„ÅÑ', hint: '„Å§„Å™„Åå„Çä„ÄÅ„Åä‰∫í„ÅÑ„ÅÆÈñ¢„Çè„Çä', difficulty: 2 },
                    { type: 'both', word: '„Åã„Çì„Åï„Å§', reading: '„Åã„Çì„Åï„Å§', hint: '„Çà„ÅèË¶ã„Å¶Ë™ø„Åπ„Çã„ÄÅÁêÜÁßë„ÅÆ„Åò„Å£„Åë„Çì„Åß', difficulty: 2 },
                    { type: 'both', word: 'È°ò„ÅÑ', reading: '„Å≠„Åå„ÅÑ', hint: 'ÂøÉ„Åã„ÇâÊúõ„ÇÄ„Åì„Å®„ÄÅ„ÅäÁ•à„Çä„Åô„Çã„Åì„Å®', difficulty: 1 },
                    { type: 'both', word: '„Åç„Åº„ÅÜ', reading: '„Åç„Åº„ÅÜ', hint: '„Åì„ÅÜ„Å™„Å£„Å¶Ê¨≤„Åó„ÅÑ„Å®„ÅÑ„ÅÜÊ∞óÊåÅ„Å°', difficulty: 2 },
                    { type: 'both', word: '„Åç„Åõ„Å§', reading: '„Åç„Åõ„Å§', hint: 'Êò•Â§èÁßãÂÜ¨„ÄÅ‰∏ÄÂπ¥„ÅÆÊôÇÊúü', difficulty: 1 },
                    { type: 'both', word: 'Âñú„Å∂', reading: '„Çà„Çç„Åì„Å∂', hint: '„ÅÜ„Çå„Åó„ÅÑÊ∞óÊåÅ„Å°„Å´„Å™„Çã„ÄÅ„Åà„Åå„Åä„Å´„Å™„Çã', difficulty: 1 },
                    { type: 'both', word: 'Êóó', reading: '„ÅØ„Åü', hint: 'ÂõΩ„ÇÑÂ≠¶Ê†°„ÅÆÂç∞„ÄÅÈ¢®„Åß„Å≤„Çâ„Å≤„Çâ', difficulty: 1 },
                    { type: 'both', word: 'Âô®ÂÖ∑', reading: '„Åç„Åê', hint: '‰Ωï„Åã„Çí„Åô„Çã„Åü„ÇÅ„ÅÆÈÅìÂÖ∑', difficulty: 2 },
                    { type: 'both', word: '„Åé„Çç„Çì', reading: '„Åé„Çç„Çì', hint: '„Åø„Çì„Å™„ÅßË©±„ÅóÂêà„ÅÜ„ÄÅ„ÅÑ„Åë„Çì„Çí„Åì„ÅÜ„Åã„Çì„Åô„Çã', difficulty: 2 }
                ]
            };

            // 5Âπ¥Áîü„ÅÆ„Éá„Éº„Çø
            kanjiDatabase[5] = {
                grade: 5,
                kanjiList: ["Âúß", "Âõ≤", "Áßª", "Âõ†", "Ê∞∏", "Âñ∂", "Ë°õ", "Êòì", "Áõä", "Ê∂≤", "Êºî", "Âøú", "ÂæÄ", "Ê°ú", "ÂèØ", "‰ªÆ", "‰æ°", "Ê≤≥", "ÈÅé", "Âø´", "Ëß£", "Ê†º", "Á¢∫", "È°ç", "Âàä", "Âππ", "ÊÖ£", "Áúº", "Á¥Ä", "Âü∫", "ÂØÑ", "Ë¶è", "Âñú", "ÊäÄ", "Áæ©", "ÈÄÜ", "‰πÖ", "Êóß", "Êïë", "Â±Ö", "Ë®±", "Â¢É", "Âùá", "Á¶Å", "Âè•", "Âûã", "Áµå", "ÊΩî", "‰ª∂", "Èô∫", "Ê§ú", "Èôê", "Áèæ", "Ê∏õ", "ÊïÖ", "ÂÄã", "Ë≠∑", "Âäπ", "Âéö", "ËÄï", "Ëà™", "Èâ±", "Êßã", "Ëàà", "Ë¨õ", "Âëä", "Ê∑∑", "Êüª", "ÂÜç", "ÁÅΩ", "Â¶ª", "Êé°", "Èöõ", "Âú®", "Ë≤°", "ÁΩ™", "ÊÆ∫", "Èõë", "ÈÖ∏", "Ë≥õ", "Â£´", "ÊîØ", "Âè≤", "Âøó", "Êûù", "Â∏´", "Ë≥á", "È£º", "Á§∫", "‰ºº", "Ë≠ò", "Ë≥™", "Ëàé", "Ë¨ù", "Êéà", "‰øÆ", "Ëø∞", "Ë°ì", "Ê∫ñ", "Â∫è", "Êãõ", "Ë®º", "Ë±°", "Ë≥û", "Êù°", "Áä∂", "Â∏∏", "ÊÉÖ", "Áπî", "ËÅ∑", "Âà∂", "ÊÄß", "Êîø", "Âã¢", "Á≤æ", "Ë£Ω", "Á®é", "Ë≤¨", "Á∏æ", "Êé•", "Ë®≠", "Áµ∂", "Á•ñ", "Á¥†", "Á∑è", "ÈÄ†", "ÂÉè", "Â¢ó", "Ââá", "Ê∏¨", "Â±û", "Áéá", "Êêç", "Ë≤∏", "ÊÖã", "Âõ£", "Êñ≠", "ÁØâ", "Ë≤Ø", "Âºµ", "ÂÅú", "Êèê", "Á®ã", "ÈÅ©", "Áµ±", "Â†Ç", "ÈäÖ", "Â∞é", "Âæó", "ÊØí", "Áã¨", "‰ªª", "ÁáÉ", "ËÉΩ", "Á†¥", "ÁäØ", "Âà§", "Áâà", "ÊØî", "ËÇ•", "Èùû", "Ë≤ª", "ÂÇô", "Ë©ï", "Ë≤ß", "Â∏É", "Â©¶", "Ê≠¶", "Âæ©", "Ë§á", "‰ªè", "Á≤â", "Á∑®", "ÂºÅ", "‰øù", "Â¢ì", "Â†±", "Ë±ä", "Èò≤", "Ë≤ø", "Êö¥", "ËÑà", "Âãô", "Â§¢", "Ëø∑", "Á∂ø", "Ëº∏", "‰Ωô", "ÂÆπ", "Áï•", "Áïô", "È†ò", "Ê≠¥"],
                questions: [
                    { type: 'both', word: 'ÂúßÂäõ', reading: '„ÅÇ„Å§„Çä„Çá„Åè', hint: 'Âº∑„ÅèÊäº„Åó„Å§„Åë„ÇãÂäõ„ÄÅ„Éó„É¨„ÉÉ„Ç∑„É£„Éº', difficulty: 2 },
                    { type: 'both', word: 'ÁßªÂãï', reading: '„ÅÑ„Å©„ÅÜ', hint: 'Â†¥ÊâÄ„ÇíÂ§â„Åà„Å¶Âãï„Åè„ÄÅ„Å≤„Å£„Åì„Åó„Å™„Å©', difficulty: 2 },
                    { type: 'both', word: 'ÂéüÂõ†', reading: '„Åí„Çì„ÅÑ„Çì', hint: '„Å™„Åú„Åù„ÅÜ„Å™„Å£„Åü„Åã„ÅÆÁêÜÁî±„ÄÅ„Åç„Å£„Åã„Åë', difficulty: 2 },
                    { type: 'both', word: 'Ê∞∏ÈÅ†', reading: '„Åà„ÅÑ„Åà„Çì', hint: '„ÅÑ„Å§„Åæ„Åß„ÇÇÁ∂ö„Åè„ÄÅÁµÇ„Çè„Çä„Åå„Å™„ÅÑ', difficulty: 2 },
                    { type: 'both', word: 'Âñ∂Ê•≠', reading: '„Åà„ÅÑ„Åé„Çá„ÅÜ', hint: '„Åó„Çá„ÅÜ„Å∞„ÅÑ„Çí„Åô„Çã„ÄÅ„ÅäÂ∫ó„ÇíÈñã„Åë„Å¶„ÅÑ„Çã', difficulty: 2 },
                    { type: 'both', word: 'Ë°õÁîü', reading: '„Åà„ÅÑ„Åõ„ÅÑ', hint: '„Åõ„ÅÑ„Åë„Å§„Åß„Åë„Çì„Åì„ÅÜ„Å¶„Åç„ÄÅ„Å≥„Çá„ÅÜ„Åç„Çí„Åµ„Åõ„Åê', difficulty: 2 },
                    { type: 'both', word: 'ÂÆπÊòì', reading: '„Çà„ÅÜ„ÅÑ', hint: '„Åã„Çì„Åü„Çì„ÅßÈõ£„Åó„Åè„Å™„ÅÑ„ÄÅ„ÇÑ„Çä„ÇÑ„Åô„ÅÑ', difficulty: 2 },
                    { type: 'both', word: 'Âà©Áõä', reading: '„Çä„Åà„Åç', hint: '„Å®„Åè„Çí„Åô„Çã„Åì„Å®„ÄÅ„ÇÇ„ÅÜ„Åë', difficulty: 2 },
                    { type: 'both', word: 'Ê∂≤‰Ωì', reading: '„Åà„Åç„Åü„ÅÑ', hint: 'Ê∞¥„ÅÆ„Çà„ÅÜ„Å´ÊµÅ„Çå„Çã„ÇÇ„ÅÆ„ÄÅ„Åì„Åü„ÅÑ„Åß„Å™„ÅÑ„ÇÇ„ÅÆ', difficulty: 2 },
                    { type: 'both', word: 'ÊºîÂ•è', reading: '„Åà„Çì„Åù„ÅÜ', hint: '„Åå„Å£„Åç„Çí‰Ωø„Å£„Å¶Èü≥Ê•Ω„ÇíÂ•è„Åß„Çã', difficulty: 2 },
                    { type: 'both', word: 'ÂøúÊè¥', reading: '„Åä„ÅÜ„Åà„Çì', hint: '„Åå„Çì„Å∞„Å£„Å¶„ÅÑ„Çã‰∫∫„Çí„ÅØ„Åí„Åæ„Åô„ÄÅ„Åó„Åà„Çì„Åô„Çã', difficulty: 2 },
                    { type: 'both', word: 'ÂæÄÂæ©', reading: '„Åä„ÅÜ„Åµ„Åè', hint: 'Ë°å„Åç„Å®Â∏∞„Çä„ÄÅ„Åù„Åì„Åæ„ÅßË°å„Å£„Å¶Êàª„Å£„Å¶„Åè„Çã', difficulty: 2 },
                    { type: 'both', word: 'Ê°ú', reading: '„Åï„Åè„Çâ', hint: 'Êò•„Å´Âí≤„Åè„Éî„É≥„ÇØ„ÅÆËä±„ÄÅÊó•Êú¨„ÅÆ„Å†„ÅÑ„Å≤„Çá„ÅÜ„Å¶„Åç„Å™Ëä±', difficulty: 1 },
                    { type: 'both', word: 'ÊÅ©Ëøî„Åó', reading: '„Åä„Çì„Åå„Åà„Åó', hint: '„Åä‰∏ñË©±„Å´„Å™„Å£„Åü‰∫∫„Å´„ÅäÁ§º„Çí„Åô„Çã', difficulty: 2 },
                    { type: 'both', word: 'ÂèØËÉΩ', reading: '„Åã„ÅÆ„ÅÜ', hint: '„Åß„Åç„Çã„Åì„Å®„ÄÅ„Åò„Å§„Åí„Çì„Åß„Åç„Çã', difficulty: 2 },
                    { type: 'both', word: '‰ªÆÂÆö', reading: '„Åã„Å¶„ÅÑ', hint: '„ÇÇ„Åó„ÇÇ„ÅÆË©±„ÄÅ„Åù„ÅÜ„Åû„ÅÜ„ÅßËÄÉ„Åà„Çã', difficulty: 2 },
                    { type: 'both', word: '‰æ°Ê†º', reading: '„Åã„Åã„Åè', hint: 'Áâ©„ÅÆ„Å≠„Å†„Çì„ÄÅ„ÅäÈáë„ÅÆ„Çä„Çá„ÅÜ', difficulty: 2 },
                    { type: 'both', word: 'Ê≤≥Â∑ù', reading: '„Åã„Åõ„Çì', hint: 'Â∑ù„ÅÆÊµÅ„Çå„ÄÅÊ∞¥„ÅåÊµÅ„Çå„ÇãÈÅì', difficulty: 2 },
                    { type: 'both', word: 'ÈÅéÂéª', reading: '„Åã„Åì', hint: '‰ªä„Çà„ÇäÂâç„ÅÆÊôÇÈñì„ÄÅÊòî„ÅÆ„Åì„Å®', difficulty: 2 },
                    { type: 'both', word: 'Âø´ÈÅ©', reading: '„Åã„ÅÑ„Å¶„Åç', hint: 'Ê∞óÊåÅ„Å°„Çà„Åè„Å¶ÈÅé„Åî„Åó„ÇÑ„Åô„ÅÑ', difficulty: 2 },
                    { type: 'both', word: 'Ëß£Ê±∫', reading: '„Åã„ÅÑ„Åë„Å§', hint: '„ÇÇ„Çì„Å†„ÅÑ„ÇíËß£„ÅÑ„Å¶Á≠î„Åà„ÇíË¶ã„Å§„Åë„Çã', difficulty: 2 },
                    { type: 'both', word: 'Ê†ºÂ•Ω', reading: '„Åã„Å£„Åì„ÅÜ', hint: '„Åµ„Åè„Åù„ÅÜ„ÇÑË¶ã„ÅüÁõÆ„ÄÅ„Çπ„Çø„Ç§„É´', difficulty: 2 },
                    { type: 'both', word: 'Á¢∫Ë™ç', reading: '„Åã„Åè„Å´„Çì', hint: '„Åæ„Å°„Åå„ÅÑ„Åå„Å™„ÅÑ„ÅãË™ø„Åπ„Çã„ÄÅ„ÉÅ„Çß„ÉÉ„ÇØ„Åô„Çã', difficulty: 2 },
                    { type: 'both', word: 'ÈáëÈ°ç', reading: '„Åç„Çì„Åå„Åè', hint: '„ÅäÈáë„ÅÆ„Çä„Çá„ÅÜ„ÄÅ„Å†„ÅÑ„Åç„Çì„ÅÆ„Åî„ÅÜ„Åë„ÅÑ', difficulty: 2 },
                    { type: 'both', word: 'Áô∫Âàä', reading: '„ÅØ„Å£„Åã„Çì', hint: 'Êú¨„ÇÑ„Åñ„Å£„Åó„Çí„Åó„ÇÖ„Å£„Å±„Çì„Åô„Çã„ÄÅ‰∏ñ„Å´Âá∫„Åô', difficulty: 2 },
                    { type: 'both', word: 'Âππ‰∫ã', reading: '„Åã„Çì„Åò', hint: '„Ç∞„É´„Éº„Éó„ÅÆ‰∏ñË©±„ÇÑ„Åè„ÄÅ„Åæ„Å®„ÇÅ„ÇÑ„Åè', difficulty: 2 },
                    { type: 'both', word: 'ÁøíÊÖ£', reading: '„Åó„ÇÖ„ÅÜ„Åã„Çì', hint: 'ÊØéÊó•Á∂ö„Åë„Å¶„ÅÑ„Çã„Åì„Å®„ÄÅ„ÇØ„Çª', difficulty: 2 },
                    { type: 'both', word: 'ÁúºÈè°', reading: '„ÇÅ„Åå„Å≠', hint: 'ÁõÆ„Å´„Åã„Åë„ÇãÈÅìÂÖ∑„ÄÅ„Åó„Çä„Çá„Åè„Çí„Åª„Åõ„ÅÑ„Åô„Çã', difficulty: 1 },
                    { type: 'both', word: 'Âü∫Êú¨', reading: '„Åç„Åª„Çì', hint: '‰∏ÄÁï™Â§ßÂàá„Å™ÂúüÂè∞„ÄÅ„Åç„Åù„Å®„Å™„Çã„Åì„Å®', difficulty: 2 },
                    { type: 'both', word: 'ÂØÑ‰ªò', reading: '„Åç„Åµ', hint: '„Åì„Åæ„Å£„Å¶„ÅÑ„Çã‰∫∫„Å´„ÅäÈáë„ÇÑÁâ©„Çí„Åä„Åè„Çã', difficulty: 2 }
                ]
            };

            // 6Âπ¥Áîü„ÅÆ„Éá„Éº„Çø
            kanjiDatabase[6] = {
                grade: 6,
                kanjiList: ["ËÉÉ", "Áï∞", "ÈÅ∫", "Âüü", "ÂÆá", "Êò†", "Âª∂", "Ê≤ø", "ÊÅ©", "Êàë", "ÁÅ∞", "Êã°", "Èù©", "Èñ£", "Ââ≤", "Ê†™", "Âπ≤", "Â∑ª", "Áúã", "Á∞°", "Âç±", "Êú∫", "ÊèÆ", "Ë≤¥", "Áñë", "Âê∏", "‰æõ", "ËÉ∏", "ÈÉ∑", "Âã§", "Á≠ã", "Á≥ª", "Êï¨", "Ë≠¶", "Âäá", "ÊøÄ", "Á©¥", "Âà∏", "Áµπ", "Ê®©", "ÊÜ≤", "Ê∫ê", "Âé≥", "Â∑±", "Âëº", "Ë™§", "Âêé", "Â≠ù", "Áöá", "Á¥Ö", "Èôç", "Èãº", "Âàª", "Á©Ä", "È™®", "Âõ∞", "Á†Ç", "Â∫ß", "Ê∏à", "Ë£Å", "Á≠ñ", "ÂÜä", "Ëöï", "Ëá≥", "ÁßÅ", "Âßø", "Ë¶ñ", "Ë©û", "Ë™å", "Á£Å", "Â∞Ñ", "Êç®", "Â∞∫", "Ëã•", "Ê®π", "Âèé", "ÂÆó", "Â∞±", "Ë°Ü", "Âæì", "Á∏¶", "Á∏Æ", "ÁÜü", "Á¥î", "Âá¶", "ÁΩ≤", "Ë´∏", "Èô§", "Êâø", "Â∞Ü", "ÂÇ∑", "Èöú", "Ëí∏", "Èáù", "‰ªÅ", "ÂûÇ", "Êé®", "ÂØ∏", "Áõõ", "ËÅñ", "Ë™†", "Ëàå", "ÂÆ£", "Â∞Ç", "Ê≥â", "Ê¥ó", "Êüì", "Èä≠", "ÂñÑ", "Â•è", "Á™ì", "Ââµ", "Ë£Ö", "Â±§", "Êìç", "Ëîµ", "Ëáì", "Â≠ò", "Â∞ä", "ÈÄÄ", "ÂÆÖ", "ÊãÖ", "Êé¢", "Ë™ï", "ÊÆµ", "Êöñ", "ÂÄ§", "ÂÆô", "Âø†", "Ëëó", "Â∫Å", "È†Ç", "ËÖ∏", "ÊΩÆ", "Ë≥É", "Áóõ", "Êïµ", "Â±ï", "Ë®é", "ÂÖö", "Á≥ñ", "Â±ä", "Èõ£", "‰π≥", "Ë™ç", "Á¥ç", "ËÑ≥", "Ê¥æ", "Êãù", "ËÉå", "ËÇ∫", "‰ø≥", "Áè≠", "Êô©", "Âê¶", "Êâπ", "Áßò", "‰øµ", "ËÖπ", "Â•Æ", "‰∏¶", "Èôõ", "Èñâ", "Áâá", "Ë£ú", "ÊöÆ", "ÂÆù", "Ë®™", "‰∫°", "Âøò", "Ê£í", "Êûö", "Âπï", "ÂØÜ", "Áõü", "Ê®°", "Ë®≥", "ÈÉµ", "ÂÑ™", "È†ê", "Âπº", "Ê¨≤", "Áøå", "‰π±", "Âçµ", "Ë¶ß", "Ë£è", "Âæã", "Ëá®", "Êúó", "Ë´ñ"],
                questions: [
                    { type: 'both', word: 'Áï∞Â∏∏', reading: '„ÅÑ„Åò„Çá„ÅÜ', hint: '„Åµ„Å§„ÅÜ„Å®ÈÅï„ÅÜ„ÄÅ„Åä„Åã„Åó„Å™Áä∂ÊÖã', difficulty: 2 },
                    { type: 'both', word: 'ÈÅ∫Ë∑°', reading: '„ÅÑ„Åõ„Åç', hint: 'Êòî„ÅÆ‰∫∫„ÅåÊÆã„Åó„ÅüÂª∫Áâ©„ÇÑÈÅìÂÖ∑„ÅÆË∑°', difficulty: 2 },
                    { type: 'both', word: 'Âú∞Âüü', reading: '„Å°„ÅÑ„Åç', hint: '„ÅÇ„ÇãÁØÑÂõ≤„ÅÆÂúüÂú∞„ÄÅ„Å°„Åè', difficulty: 2 },
                    { type: 'both', word: 'ÂÆáÂÆô', reading: '„ÅÜ„Å°„ÇÖ„ÅÜ', hint: 'Âú∞ÁêÉ„ÅÆÂ§ñ„ÅÆ„ÇÄ„Åí„Çì„Å´Â∫É„Åå„ÇãÁ©∫Èñì', difficulty: 2 },
                    { type: 'both', word: 'Êò†Áîª', reading: '„Åà„ÅÑ„Åå', hint: '„Çπ„ÇØ„É™„Éº„É≥„Å´Êò†„ÇãÂãï„ÅèÁµµ„ÄÅ„É†„Éº„Éì„Éº', difficulty: 1 },
                    { type: 'both', word: 'Âª∂Èï∑', reading: '„Åà„Çì„Å°„Çá„ÅÜ', hint: 'ÊôÇÈñì„ÇÑÈï∑„Åï„Çí‰º∏„Å∞„Åô„ÄÅÈï∑„Åè„Åô„Çã', difficulty: 2 },
                    { type: 'both', word: 'Ê≤øÂ≤∏', reading: '„Åà„Çì„Åå„Çì', hint: 'Êµ∑„ÇÑÂ∑ù„ÅÆÂ≤∏„Å´Ê≤ø„Å£„ÅüÂú∞Âüü', difficulty: 2 },
                    { type: 'both', word: 'ÊÅ©ÊÅµ', reading: '„Åä„Çì„Åë„ÅÑ', hint: 'Âèó„Åë„Åü„Åó„Çì„Åõ„Å§„ÇÑ„ÇÅ„Åê„Åø„ÄÅ„ÅÇ„Çä„Åå„Åü„ÅÑ„Åì„Å®', difficulty: 2 },
                    { type: 'both', word: 'Ëá™Êàë', reading: '„Åò„Åå', hint: 'Ëá™ÂàÜ„Å®„ÅÑ„ÅÜ„ÅÑÂºè„ÄÅ„Åò„Åì', difficulty: 2 },
                    { type: 'both', word: 'ÁÅ∞Ëâ≤', reading: '„ÅØ„ÅÑ„ÅÑ„Çç', hint: 'ÁôΩ„Å®Èªí„ÅÆ‰∏≠Èñì„ÅÆËâ≤„ÄÅ„Ç∞„É¨„Éº', difficulty: 1 },
                    { type: 'both', word: 'Êã°Â§ß', reading: '„Åã„Åè„Å†„ÅÑ', hint: 'Â§ß„Åç„Åè„Åô„Çã„ÄÅÂ∫É„Åí„Çã', difficulty: 2 },
                    { type: 'both', word: 'Èù©ÂëΩ', reading: '„Åã„Åè„ÇÅ„ÅÑ', hint: '„Åó„ÇÉ„Åã„ÅÑ„ÇíÂ§ß„Åç„ÅèÂ§â„Åà„ÇãÂá∫Êù•‰∫ã', difficulty: 2 },
                    { type: 'both', word: 'ÂÜÖÈñ£', reading: '„Å™„ÅÑ„Åã„Åè', hint: 'ÂõΩ„ÅÆ„Åõ„ÅÑ„Åò„ÇíË°å„ÅÜ„Å†„ÅÑ„Åò„Çì„Åü„Å°„ÅÆÈõÜ„Åæ„Çä', difficulty: 2 },
                    { type: 'both', word: 'Ââ≤Âêà', reading: '„Çè„Çä„ÅÇ„ÅÑ', hint: '„Åú„Çì„Åü„ÅÑ„Å´ÂØæ„Åô„ÇãÈÉ®ÂàÜ„ÅÆ„Å≤„Çä„Å§„ÄÅ„Éë„Éº„Çª„É≥„Éà', difficulty: 2 },
                    { type: 'both', word: 'Ê†™Âºè', reading: '„Åã„Å∂„Åó„Åç', hint: '„Åã„ÅÑ„Åó„ÇÉ„ÅÆ„Åó„Çá„ÇÜ„ÅÜ„Åë„Çì„ÇíË°®„Åô„Åó„Çá„ÅÜ„Åë„Çì', difficulty: 2 },
                    { type: 'both', word: 'Âπ≤ÊΩü', reading: '„Å≤„Åå„Åü', hint: '„Åó„Åä„ÅåÂºï„ÅÑ„ÅüÊôÇ„Å´„ÅÇ„Çâ„Çè„Çå„ÇãÊµ∑Â∫ï', difficulty: 2 },
                    { type: 'both', word: 'Â∑ªÁâ©', reading: '„Åæ„Åç„ÇÇ„ÅÆ', hint: 'Á¥ô„ÇÑÂ∏É„ÇíÂ∑ª„ÅÑ„ÅüÊòî„ÅÆ„Åó„Çá„ÇÇ„Å§', difficulty: 2 },
                    { type: 'both', word: 'ÁúãË≠∑', reading: '„Åã„Çì„Åî', hint: '„Å≥„Çá„ÅÜ„Åç„ÅÆ‰∫∫„ÅÆ‰∏ñË©±„Çí„Åô„Çã„ÄÅ„Ç±„Ç¢„Åô„Çã', difficulty: 2 },
                    { type: 'both', word: 'Á∞°Âçò', reading: '„Åã„Çì„Åü„Çì', hint: '„ÇÑ„Åï„Åó„ÅÑ„ÄÅÈõ£„Åó„Åè„Å™„ÅÑ', difficulty: 1 },
                    { type: 'both', word: 'Âç±Ê©ü', reading: '„Åç„Åç', hint: '„Åç„Åë„Çì„Å™„Åò„Çá„ÅÜ„Åç„Çá„ÅÜ„ÄÅ„Éî„É≥„ÉÅ', difficulty: 2 },
                    { type: 'both', word: 'Êú∫', reading: '„Å§„Åè„Åà', hint: '„Åπ„Çì„Åç„Çá„ÅÜ„ÇÑ‰ªï‰∫ã„Çí„Åô„ÇãÊôÇ„Å´‰Ωø„ÅÜÂè∞', difficulty: 1 },
                    { type: 'both', word: 'Ë≤¥Èáç', reading: '„Åç„Å°„Çá„ÅÜ', hint: '„Å®„Å¶„ÇÇÂ§ßÂàá„Åß„Åã„Å°„ÅÆ„ÅÇ„Çã', difficulty: 2 },
                    { type: 'both', word: 'ÁñëÂïè', reading: '„Åé„ÇÇ„Çì', hint: 'ÂàÜ„Åã„Çâ„Å™„ÅÑ„Åì„Å®„ÄÅ„Åó„Å§„ÇÇ„Çì„Åó„Åü„ÅÑ„Åì„Å®', difficulty: 2 },
                    { type: 'both', word: 'ÂëºÂê∏', reading: '„Åì„Åç„ÇÖ„ÅÜ', hint: '„ÅÑ„Åç„ÇíÂê∏„Å£„Åü„ÇäÂêê„ÅÑ„Åü„Çä„Åô„Çã„Åì„Å®', difficulty: 2 },
                    { type: 'both', word: '‰æõÁµ¶', reading: '„Åç„Çá„ÅÜ„Åç„ÇÖ„ÅÜ', hint: '„Å≤„Å§„Çà„ÅÜ„Å™„ÇÇ„ÅÆ„Çí„Å¶„ÅÑ„Åç„Çá„ÅÜ„Åô„Çã„ÄÅ„ÅÇ„Åü„Åà„Çã', difficulty: 2 },
                    { type: 'both', word: 'ËÉ∏', reading: '„ÇÄ„Å≠', hint: '‰Ωì„ÅÆÂâç„Åå„Çè„ÄÅ„Åó„Çì„Åû„ÅÜ„Åå„ÅÇ„ÇãÈÉ®ÂàÜ', difficulty: 1 },
                    { type: 'both', word: 'ÊïÖÈÉ∑', reading: '„Åì„Åç„Çá„ÅÜ', hint: 'Áîü„Åæ„ÇåËÇ≤„Å£„ÅüÂúüÂú∞„ÄÅ„Åµ„Çã„Åï„Å®', difficulty: 2 },
                    { type: 'both', word: 'Âã§Âãô', reading: '„Åç„Çì„ÇÄ', hint: '„Åã„ÅÑ„Åó„ÇÉ„ÇÑ„Åó„Çá„Åè„Å∞„ÅßÂÉç„Åè„Åì„Å®', difficulty: 2 },
                    { type: 'both', word: 'Á≠ãËÇâ', reading: '„Åç„Çì„Å´„Åè', hint: '‰Ωì„ÇíÂãï„Åã„Åô„Åü„ÇÅ„ÅÆ„Åù„Åó„Åç„ÄÅ„Éû„ÉÉ„Çπ„É´', difficulty: 2 },
                    { type: 'both', word: 'Á≥ªÁµ±', reading: '„Åë„ÅÑ„Å®„ÅÜ', hint: '„Å§„Å™„Åå„Çä„ÅÆ„ÅÇ„Çã„Å™„Åã„Åæ„ÄÅ„Ç∞„É´„Éº„Éó', difficulty: 2 }
                ]
            };

            // ÂÖ®Â≠¶Âπ¥„ÅÆÊº¢Â≠ó„É™„Çπ„Éà„Çí‰ΩúÊàê
            for (let i = 1; i <= 6; i++) {
                allKanjiByGrade[i] = [];
                for (let j = 1; j <= i; j++) {
                    if (kanjiDatabase[j] && kanjiDatabase[j].kanjiList) {
                        allKanjiByGrade[i] = allKanjiByGrade[i].concat(kanjiDatabase[j].kanjiList);
                    }
                }
            }
        }

        // JSON„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„ÇÄÈñ¢Êï∞
        function loadKanjiData(grade) {
            // „Åæ„Åö„Ç≠„É£„ÉÉ„Ç∑„É•„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            if (kanjiDatabase[grade] && kanjiDatabase[grade].questions.length > 0) {
                return Promise.resolve(kanjiDatabase[grade]);
            }
            
            // „É≠„Éº„Ç´„É´„Éï„Ç°„Ç§„É´„ÅÆÂ†¥Âêà„ÅØÂüã„ÇÅËæº„Åø„Éá„Éº„Çø„Çí‰ΩøÁî®
            if (window.location.protocol === 'file:') {
                return loadEmbeddedKanjiData(grade);
            }
            
            // HTTP„Çµ„Éº„Éê„ÉºÁµåÁî±„ÅßJSON„Éï„Ç°„Ç§„É´„Åã„ÇâË™≠„ÅøËæº„Åø
            return fetch('./data/grade' + grade + '.json')
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('„Éá„Éº„Çø„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    }
                    return response.json();
                })
                .then(function(data) {
                    // „Éá„Éº„Çø„Çí„Ç≠„É£„ÉÉ„Ç∑„É•
                    kanjiDatabase[grade] = data;
                    
                    // ÂÖ®Â≠¶Âπ¥„ÅÆÊº¢Â≠ó„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
                    updateAllKanjiList(grade, data.kanjiList);
                    
                    return data;
                })
                .catch(function(error) {
                    console.error('„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºöÂüã„ÇÅËæº„Åø„Éá„Éº„Çø„Çí‰ΩøÁî®
                    return loadEmbeddedKanjiData(grade);
                });
        }

        // Âüã„ÇÅËæº„Åø„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄÈñ¢Êï∞
        function loadEmbeddedKanjiData(grade) {
            return new Promise(function(resolve, reject) {
                if (kanjiDatabase[grade]) {
                    // ÂÖ®Â≠¶Âπ¥„ÅÆÊº¢Â≠ó„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
                    updateAllKanjiList(grade, kanjiDatabase[grade].kanjiList);
                    resolve(kanjiDatabase[grade]);
                } else {
                    reject(new Error('Â≠¶Âπ¥„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì'));
                }
            });
        }

        // ÂÖ®Â≠¶Âπ¥„ÅÆÊº¢Â≠ó„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
        function updateAllKanjiList(grade, kanjiList) {
            if (!allKanjiByGrade[grade]) {
                allKanjiByGrade[grade] = [];
            }
            
            // „Åù„ÅÆÂ≠¶Âπ¥„Åæ„Åß„ÅÆÂÖ®Êº¢Â≠ó„ÇíÁ¥ØÁ©ç
            allKanjiByGrade[grade] = [];
            for (let g = 1; g <= grade; g++) {
                if (kanjiDatabase[g] && kanjiDatabase[g].kanjiList) {
                    allKanjiByGrade[grade] = allKanjiByGrade[grade].concat(kanjiDatabase[g].kanjiList);
                }
            }
        }

        // Áøí„Å£„ÅüÊº¢Â≠ó„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        function isKanjiLearned(kanji, grade) {
            return allKanjiByGrade[grade] && allKanjiByGrade[grade].indexOf(kanji) !== -1;
        }

        // ÂçòË™û„ÇíË™øÊï¥ÔºàÊú™ÁøíÂæóÊº¢Â≠ó„Çí„Å≤„Çâ„Åå„Å™„Å´Ôºâ
        function adjustWord(word, grade) {
            let adjusted = '';
            for (let i = 0; i < word.length; i++) {
                const char = word[i];
                if (isKanjiLearned(char, grade) || isHiragana(char) || isKatakana(char)) {
                    adjusted += char;
                } else {
                    adjusted += 'Ôºü';
                }
            }
            return adjusted;
        }

        // Â≠¶Âπ¥„Å´Âøú„Åò„Å¶Êº¢Â≠ó„ÇíË™øÊï¥ÔºàÈ´òÂ≠¶Âπ¥Êº¢Â≠ó„Çí„Å≤„Çâ„Åå„Å™„Å´Â§âÊèõÔºâ
        function adjustWordForGrade(text, grade) {
            if (!text) return '';
            
            // Êº¢Â≠ó„Åã„Çâ„Å≤„Çâ„Åå„Å™„Å∏„ÅÆÂ§âÊèõ„Éû„ÉÉ„ÉóÔºàÂü∫Êú¨ÁöÑ„Å™Â§âÊèõ‰æãÔºâ
            const kanjiToHiragana = {
                // È´òÂ≠¶Âπ¥„Åß„Çà„Åè‰Ωø„Çè„Çå„ÇãÊº¢Â≠ó„ÅÆÂ§âÊèõ‰æã
                'ÂãâÂº∑': '„Åπ„Çì„Åç„Çá„ÅÜ',
                'ÈÅãÂãï': '„ÅÜ„Çì„Å©„ÅÜ',
                'ÂãïÁâ©': '„Å©„ÅÜ„Å∂„Å§',
                'Ê§çÁâ©': '„Åó„Çá„Åè„Å∂„Å§',
                'Âª∫Áâ©': '„Åü„Å¶„ÇÇ„ÅÆ',
                'È£üÁâ©': '„Åó„Çá„Åè„ÇÇ„Å§',
                'Áâ©Ë™û': '„ÇÇ„ÅÆ„Åå„Åü„Çä',
                'Âõ≥Êõ∏': '„Å®„Åó„Çá',
                'Èü≥Ê•Ω': '„Åä„Çì„Åå„Åè',
                'ÁæéË°ì': '„Å≥„Åò„ÇÖ„Å§',
                '‰ΩìËÇ≤': '„Åü„ÅÑ„ÅÑ„Åè',
                'ÁêÜÁßë': '„Çä„Åã',
                'Á§æ‰ºö': '„Åó„ÇÉ„Åã„ÅÑ',
                'ÁÆóÊï∞': '„Åï„Çì„Åô„ÅÜ',
                'ÂõΩË™û': '„Åì„Åè„Åî',
                'Ëã±Ë™û': '„Åà„ÅÑ„Åî',
                'Ê≠¥Âè≤': '„Çå„Åç„Åó',
                'Âú∞ÁêÜ': '„Å°„Çä',
                'ÁßëÂ≠¶': '„Åã„Åå„Åè',
                'Ëá™ÁÑ∂': '„Åó„Åú„Çì',
                'Áí∞Â¢É': '„Åã„Çì„Åç„Çá„ÅÜ',
                'Á§æ‰ºö': '„Åó„ÇÉ„Åã„ÅÑ',
                'ÊñáÂåñ': '„Å∂„Çì„Åã',
                'ÁµåÊ∏à': '„Åë„ÅÑ„Åñ„ÅÑ',
                'ÊîøÊ≤ª': '„Åõ„ÅÑ„Åò',
                'ÂÅ•Â∫∑': '„Åë„Çì„Åì„ÅÜ',
                'ÂÆâÂÖ®': '„ÅÇ„Çì„Åú„Çì',
                'Âπ≥Âíå': '„Å∏„ÅÑ„Çè',
                'Âπ∏Á¶è': '„Åì„ÅÜ„Åµ„Åè',
                'Â∏åÊúõ': '„Åç„Åº„ÅÜ',
                'Âä™Âäõ': '„Å©„Çä„Çá„Åè',
                'ÂçîÂäõ': '„Åç„Çá„ÅÜ„Çä„Çá„Åè',
                'ÂèãÊÉÖ': '„ÇÜ„ÅÜ„Åò„Çá„ÅÜ',
                '‰ø°È†º': '„Åó„Çì„Çâ„ÅÑ',
                'Â∞äÊï¨': '„Åù„Çì„Åë„ÅÑ'
            };
            
            let adjusted = text;
            
            // „Åæ„ÅöÁÜüË™û„ÅÆÂ§âÊèõ„ÇíË©¶Ë°å
            for (let compound in kanjiToHiragana) {
                adjusted = adjusted.replace(new RegExp(compound, 'g'), kanjiToHiragana[compound]);
            }
            
            // ÂÄãÂà•„ÅÆÊº¢Â≠ó„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            let result = '';
            for (let i = 0; i < adjusted.length; i++) {
                const char = adjusted[i];
                if (isKanji(char)) {
                    // „Åù„ÅÆÂ≠¶Âπ¥‰ª•‰∏ã„ÅßÂ≠¶ÁøíÊ∏à„Åø„ÅÆÊº¢Â≠ó„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                    if (isKanjiLearned(char, grade)) {
                        result += char;
                    } else {
                        // Êú™Â≠¶Áøí„ÅÆÊº¢Â≠ó„ÅØË™≠„ÅøÊñπ„ÅßÁΩÆÊèõÔºàÁ∞°ÊòìÁöÑ„Å™Â§âÊèõÔºâ
                        result += getKanjiReading(char) || char;
                    }
                } else {
                    result += char;
                }
            }
            
            return result;
        }

        // Êº¢Â≠ó„ÅÆË™≠„ÅøÊñπ„ÇíÂèñÂæóÔºàÁ∞°ÊòìÁâàÔºâ
        function getKanjiReading(kanji) {
            const readings = {
                'Êïô': '„Åä„Åó',
                'Êéà': '„Åò„ÇÖ',
                'Ê•≠': '„Åé„Çá„ÅÜ',
                'Ë™≤': '„Åã',
                'È°å': '„Å†„ÅÑ',
                'Âïè': '„ÇÇ„Çì',
                'Á≠î': '„Åì„Åü',
                'Ëß£': '„Åã„ÅÑ',
                'Ë™¨': '„Åõ„Å§',
                'Êòé': '„ÇÅ„ÅÑ',
                'ÁêÜ': '„Çä',
                'Áî±': '„ÇÜ„ÅÜ',
                'Âéü': '„Åí„Çì',
                'Âõ†': '„ÅÑ„Çì',
                'Áµê': '„Åë„Å§',
                'Êûú': '„Åã',
                'Âäπ': '„Åì„ÅÜ',
                'ÂΩ±': '„Åà„ÅÑ',
                'Èüø': '„Åç„Çá„ÅÜ',
                'Èñ¢': '„Åã„Çì',
                '‰øÇ': '„Åë„ÅÑ',
                'ÈÄ£': '„Çå„Çì',
                'Áµ°': '„Çâ„Åè',
                'Êé•': '„Åõ„Å§',
                'Ëß¶': '„Åó„Çá„Åè',
                'ÊÑü': '„Åã„Çì',
                'ÊÉ≥': '„Åù„ÅÜ',
                'ÊÄù': '„Åä„ÇÇ',
                'ËÄÉ': '„Åã„Çì„Åå',
                'Âà§': '„ÅØ„Çì',
                'Êñ≠': '„Å†„Çì',
                'Ê±∫': '„Åç',
                'ÂÆö': '„Å¶„ÅÑ',
                'Á¢∫': '„Åü„Åó',
                'Ë™ç': '„Åø„Å®',
                'Ë®º': '„Åó„Çá„ÅÜ',
                'ÂÆü': '„Åò„Å§',
                'Èöõ': '„Åï„ÅÑ',
                'Â†¥': '„Å∞',
                'Âêà': '„ÅÇ„ÅÑ',
                'Áä∂': '„Åò„Çá„ÅÜ',
                'Ê≥Å': '„Åç„Çá„ÅÜ',
                'ÊÉÖ': '„Åò„Çá„ÅÜ',
                'Â†±': '„Åª„ÅÜ',
                'Áü•': '„Åó',
                'Ë≠ò': '„Åó„Åç',
                'ÊäÄ': '„Åé',
                'Ë°ì': '„Åò„ÇÖ„Å§',
                'ËÉΩ': '„ÅÆ„ÅÜ',
                'Âäõ': '„Çä„Åç',
                'Êâç': '„Åï„ÅÑ',
                'ËÉΩ': '„ÅÆ„ÅÜ',
                'Áâπ': '„Å®„Åè',
                'Âà•': '„Åπ„Å§',
                'ÂÄã': '„Åì',
                'ÊÄß': '„Åõ„ÅÑ',
                'Ê†º': '„Åã„Åè',
                'Ë≥™': '„Åó„Å§',
                'Èáè': '„Çä„Çá„ÅÜ',
                'Êï∞': '„Åô„ÅÜ',
                'ÂÄ§': '„Å°',
                '‰æ°': '„Åã',
                'Ë≤ª': '„Å≤',
                'Áî®': '„Çà„ÅÜ',
                'Âà©': '„Çä',
                'Áõä': '„Åà„Åç',
                'Êêç': '„Åù„Çì',
                'ÂÆ≥': '„Åå„ÅÑ',
                'Âç±': '„Åç',
                'Èô∫': '„Åë„Çì',
                'Ê≥®': '„Å°„ÇÖ„ÅÜ',
                'ÊÑè': '„ÅÑ',
                'ÈõÜ': '„Åó„ÇÖ„ÅÜ',
                '‰∏≠': '„Å°„ÇÖ„ÅÜ',
                'ÂøÉ': '„Åó„Çì',
                'ÈÖç': '„ÅØ„ÅÑ',
                'ÊÖÆ': '„Çä„Çá'
            };
            
            return readings[kanji] || null;
        }

        // „Å≤„Çâ„Åå„Å™Âà§ÂÆö
        function isHiragana(char) {
            return char >= '\u3040' && char <= '\u309F';
        }

        // „Ç´„Çø„Ç´„ÉäÂà§ÂÆö
        function isKatakana(char) {
            return char >= '\u30A0' && char <= '\u30FF';
        }

        // ÂïèÈ°å„ÇíÁîüÊàê
        function generateQuestions(gradeData, grade, mode) {
            const questions = [];
            
            // ÈÅ∏ÊäûÂ≠¶Âπ¥„ÅÆÂïèÈ°å„ÅÆ„Åø„ÇíÂèéÈõÜÔºà„Åù„ÅÆÂ≠¶Âπ¥„ÅÆÊº¢Â≠ó„ÇíÂøÖ„Åö‰ΩøÁî®Ôºâ
            const currentGradeQuestions = [];
            if (kanjiDatabase[grade] && kanjiDatabase[grade].questions) {
                kanjiDatabase[grade].questions.forEach(function(q) {
                    if (q.type === 'both' || q.type === mode) {
                        currentGradeQuestions.push(q);
                    }
                });
            }

            // Âà©Áî®ÂèØËÉΩ„Å™ÂïèÈ°å„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÔºàÈÅ∏ÊäûÂ≠¶Âπ¥„ÅÆÊº¢Â≠ó„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™çÔºâ
            const availableQuestions = currentGradeQuestions.filter(function(q) {
                // ÈÅ∏ÊäûÂ≠¶Âπ¥„ÅÆÊº¢Â≠ó„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const targetGradeKanji = kanjiDatabase[grade] ? kanjiDatabase[grade].kanjiList : [];
                let hasTargetGradeKanji = false;
                
                // „Éá„Éê„ÉÉ„Ç∞Áî®„É≠„Ç∞
                console.log('ÂïèÈ°å:', q.word, '„Çø„Éº„Ç≤„ÉÉ„ÉàÂ≠¶Âπ¥:', grade, 'Êº¢Â≠ó„É™„Çπ„Éà:', targetGradeKanji.length);
                
                for (let char of q.word) {
                    if (isKanji(char) && targetGradeKanji.indexOf(char) !== -1) {
                        hasTargetGradeKanji = true;
                        console.log('Ë©≤ÂΩìÊº¢Â≠óÁô∫Ë¶ã:', char);
                        break;
                    }
                }
                
                // ÈÅ∏ÊäûÂ≠¶Âπ¥„ÅÆÊº¢Â≠ó„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÇÇ„ÄÅ„Åù„ÅÆÂ≠¶Âπ¥„ÅÆÂïèÈ°å„Å®„Åó„Å¶Âê´„ÇÅ„Çã
                // ÔºàÁÜüË™û„ÇÑË§áÂêàË™û„ÅÆÂ†¥Âêà„ÇíËÄÉÊÖÆÔºâ
                if (!hasTargetGradeKanji && targetGradeKanji.length > 0) {
                    hasTargetGradeKanji = true; // Êö´ÂÆöÁöÑ„Å´ÂÖ®„Å¶„ÅÆÂïèÈ°å„ÇíÈÄö„Åô
                }
                
                console.log('ÁµêÊûú:', hasTargetGradeKanji);
                return hasTargetGradeKanji;
            });

            // „É©„É≥„ÉÄ„É†„Å´10ÂïèÈÅ∏Êäû
            const shuffled = availableQuestions.sort(function() { return Math.random() - 0.5; });
            const selected = shuffled.slice(0, Math.min(10, shuffled.length));

            selected.forEach(function(q) {
                // Èñ¢ÈÄ£Êñá„ÅÆÊº¢Â≠ó„ÇíÂ≠¶Âπ¥‰ª•‰∏ã„Å´Âà∂ÈôêÔºàÈ´òÂ≠¶Âπ¥Êº¢Â≠ó„Çí„Å≤„Çâ„Åå„Å™Ë°®Ë®ò„Å´Â§âÊõ¥Ôºâ
                const adjustedHint = adjustWordForGrade(q.hint, grade);
                
                if (mode === 'reading') {
                    questions.push({
                        type: 'reading',
                        word: q.word, // Ë™≠„ÅøÂïèÈ°å„Åß„ÅØÊº¢Â≠ó„Çí„Åù„ÅÆ„Åæ„ÅæË°®Á§∫
                        reading: q.reading,
                        hint: adjustedHint,
                        correctAnswer: q.reading,
                        choices: generateChoices(q.reading, 'reading')
                    });
                } else {
                    questions.push({
                        type: 'writing',
                        word: q.word, // Êõ∏„ÅçÂïèÈ°å„Åß„ÇÇÁ≠î„Åà„ÅÆÊº¢Â≠ó„ÅØ„Åù„ÅÆ„Åæ„ÅæË°®Á§∫
                        reading: q.reading,
                        hint: adjustedHint
                    });
                }
            });

            return questions;
        }

        // ÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàê
        function generateChoices(correct, type) {
            const choices = [correct];
            let dummyOptions = [];
            
            if (type === 'reading') {
                dummyOptions = ['„ÅÇ„Åï', '„Å≤„Çã', '„Çà„Çã', '„Åù„Çâ', '„ÅÜ„Åø', '„ÇÑ„Åæ', '„Åã„Çè', '„ÇÇ„Çä', '„ÅØ„Å™', '„Å§„Å°', '„Åã„Åú', '„ÅÇ„ÇÅ', '„ÇÜ„Åç', '„Åè„ÇÇ', '„ÅÑ„Åë', '„Åü„Å´'];
            }
            
            while (choices.length < 4) {
                const dummy = dummyOptions[Math.floor(Math.random() * dummyOptions.length)];
                if (choices.indexOf(dummy) === -1) {
                    choices.push(dummy);
                }
            }
            
            return choices.sort(function() { return Math.random() - 0.5; });
        }

        // Â≠¶Âπ¥ÈÅ∏Êäû
        document.querySelectorAll('.grade-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                currentGrade = parseInt(this.dataset.grade);
                
                document.querySelectorAll('.grade-btn').forEach(function(b) {
                    b.classList.remove('active');
                });
                
                this.classList.add('active');
                
                // „É¢„Éº„ÉâÈÅ∏ÊäûÁîªÈù¢„ÇíË°®Á§∫
                document.getElementById('gradeSelector').style.display = 'none';
                document.getElementById('modeSelector').style.display = 'block';
            });
        });

        // „É¢„Éº„ÉâÈÅ∏Êäû
        document.querySelectorAll('.mode-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                currentMode = this.dataset.mode;
                
                document.querySelectorAll('.mode-btn').forEach(function(b) {
                    b.classList.remove('active');
                });
                
                this.classList.add('active');
                startQuiz();
            });
        });

        // „ÇØ„Ç§„Ç∫ÈñãÂßã
        function startQuiz() {
            document.getElementById('modeSelector').style.display = 'none';
            document.getElementById('loader').style.display = 'block';
            
            loadKanjiData(currentGrade).then(function(gradeData) {
                if (!gradeData) {
                    showErrorMessage('„Åì„ÅÆÂ≠¶Âπ¥„ÅÆ„Éá„Éº„Çø„ÅØ„Åæ„Å†Ê∫ñÂÇô‰∏≠„Åß„Åô„ÄÇ');
                    return;
                }
                
                currentQuestions = generateQuestions(gradeData, currentGrade, currentMode);
                
                if (currentQuestions.length === 0) {
                    showErrorMessage('ÂïèÈ°å„ÇíÁîüÊàê„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ');
                    return;
                }
                
                currentQuestionIndex = 0;
                score = 0;
                
                document.getElementById('loader').style.display = 'none';
                document.getElementById('quizContainer').style.display = 'block';
                showQuestion();
            });
        }

        // ÂïèÈ°åË°®Á§∫
        function showQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            
            // ÂïèÈ°åÁï™Âè∑„ÇíÊõ¥Êñ∞
            document.getElementById('questionCounter').textContent = 
                (currentQuestionIndex + 1) + ' / ' + currentQuestions.length;
            
            if (currentMode === 'reading') {
                // Ë™≠„Åø„ÉÜ„Çπ„Éà„É¢„Éº„Éâ
                document.getElementById('questionText').style.display = 'block';
                document.getElementById('questionText').textContent = question.word;
                document.getElementById('readingText').style.display = 'block';
                document.getElementById('readingText').textContent = '„Åì„ÅÆÊº¢Â≠ó„ÅÆË™≠„ÅøÊñπ„ÅØÔºü';
                if (question.hint) {
                    document.getElementById('readingText').textContent += ' Ôºà„Éí„É≥„Éà: ' + question.hint + 'Ôºâ';
                }
                
                document.getElementById('writingSection').style.display = 'none';
                document.getElementById('choices').style.display = 'grid';
                
                const choicesContainer = document.getElementById('choices');
                choicesContainer.innerHTML = '';
                
                question.choices.forEach(function(choice) {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.textContent = choice;
                    btn.onclick = function() { checkAnswer(choice, btn); };
                    choicesContainer.appendChild(btn);
                });
            } else {
                // Êõ∏„Åç„ÉÜ„Çπ„Éà„É¢„Éº„Éâ
                document.getElementById('questionText').style.display = 'none';
                document.getElementById('readingText').style.display = 'none';
                document.getElementById('choices').style.display = 'none';
                document.getElementById('writingSection').style.display = 'block';
                
                document.getElementById('writingDisplay').textContent = question.reading;
                
                // „Éí„É≥„Éà„ÇíË°®Á§∫
                if (question.hint) {
                    document.getElementById('writingHint').textContent = '„Éí„É≥„Éà: ' + question.hint;
                    document.getElementById('writingHint').style.display = 'block';
                } else {
                    document.getElementById('writingHint').style.display = 'none';
                }
                
                document.getElementById('answerDisplay').textContent = question.word;
                document.getElementById('answerDisplay').style.display = 'none';
                
                // Ëá™Â∑±Êé°ÁÇπ„Éú„Çø„É≥„Çí„É™„Çª„ÉÉ„Éà
                document.querySelectorAll('.check-btn').forEach(function(btn) {
                    btn.disabled = false;
                });
            }
            
            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„ÉºÊõ¥Êñ∞
            const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Á≠î„ÅàÂêà„Çè„ÅõÔºàË™≠„Åø„ÉÜ„Çπ„ÉàÁî®Ôºâ
        function checkAnswer(answer, btn) {
            const question = currentQuestions[currentQuestionIndex];
            const buttons = document.querySelectorAll('.choice-btn');
            
            buttons.forEach(function(b) { 
                b.style.pointerEvents = 'none';
                b.disabled = true;
            });
            
            if (answer === question.correctAnswer) {
                btn.classList.add('correct');
                score++;
                correctSound.play();
            } else {
                btn.classList.add('incorrect');
                wrongSound.play();
                buttons.forEach(function(b) {
                    if (b.textContent === question.correctAnswer) {
                        b.classList.add('correct');
                    }
                });
            }
            
            setTimeout(function() {
                currentQuestionIndex++;
                if (currentQuestionIndex < currentQuestions.length) {
                    showQuestion();
                } else {
                    showResult();
                }
            }, 1500);
        }

        // ÁµêÊûúË°®Á§∫
        function showResult() {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            
            const percentage = Math.round((score / currentQuestions.length) * 100);
            let message = score + ' / ' + currentQuestions.length + ' (' + percentage + '%)';
            
            if (percentage === 100) {
                message += '\nüéâ ÂÆåÁíß„Åß„ÅôÔºÅ';
                winSound.play();
            } else if (percentage >= 80) {
                message += '\nüòä „Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ';
            } else if (percentage >= 60) {
                message += '\nüôÇ „Åå„Çì„Å∞„Çä„Åæ„Åó„ÅüÔºÅ';
            } else {
                message += '\nüí™ „ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶„Åó„Çà„ÅÜÔºÅ';
            }
            
            document.getElementById('score').innerHTML = message.replace(/\n/g, '<br>');
        }

        // „Ç¢„Éó„É™ÂàùÊúüÂåñ
        window.addEventListener('DOMContentLoaded', function() {
            initializeSampleData();
        });

        // ÁÆ°ÁêÜÁîªÈù¢Èñ¢ÈÄ£„ÅÆÈñ¢Êï∞
        function showAdminPanel() {
            // „Éë„Çπ„Ç≥„Éº„ÉâË™çË®º
            const passcode = prompt('ÁÆ°ÁêÜËÄÖ„Éë„Çπ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
            if (passcode !== '0123') {
                alert('„Éë„Çπ„Ç≥„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
                return;
            }
            
            document.getElementById('adminPanel').style.display = 'flex';
            showQuestionList(); // ÂàùÊúüË°®Á§∫
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        function showAdminTab(tabName) {
            // „Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.admin-content').forEach(function(content) {
                content.style.display = 'none';
            });
            document.querySelectorAll('.admin-tab').forEach(function(tab) {
                tab.classList.remove('active');
            });

            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„ÇíË°®Á§∫
            document.getElementById('admin' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).style.display = 'block';
            event.target.classList.add('active');

            if (tabName === 'view') {
                showQuestionList();
            }
        }

        function addQuestion() {
            const grade = parseInt(document.getElementById('addGrade').value);
            const word = document.getElementById('addWord').value.trim();
            const reading = document.getElementById('addReading').value.trim();
            const hint = document.getElementById('addHint').value.trim();
            const type = document.getElementById('addType').value;
            const difficulty = parseInt(document.getElementById('addDifficulty').value);

            const resultDiv = document.getElementById('addResult');

            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            if (!word || !reading || !hint) {
                showAddResult('„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
                return;
            }

            // Êñ∞„Åó„ÅÑÂïèÈ°å„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
            const newQuestion = {
                type: type,
                word: word,
                reading: reading,
                hint: hint,
                difficulty: difficulty
            };

            // „Éá„Éº„Çø„Éô„Éº„Çπ„Å´ËøΩÂä†
            if (!kanjiDatabase[grade]) {
                kanjiDatabase[grade] = {
                    grade: grade,
                    kanjiList: [],
                    questions: []
                };
            }

            kanjiDatabase[grade].questions.push(newQuestion);

            // Êº¢Â≠ó„É™„Çπ„Éà„ÇíÊõ¥Êñ∞ÔºàÊñ∞„Åó„ÅÑÊº¢Â≠ó„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„ÇãÂ†¥ÂêàÔºâ
            for (let char of word) {
                if (isKanji(char) && kanjiDatabase[grade].kanjiList.indexOf(char) === -1) {
                    kanjiDatabase[grade].kanjiList.push(char);
                }
            }

            // „Éï„Ç©„Éº„É†„Çí„ÇØ„É™„Ç¢
            document.getElementById('addWord').value = '';
            document.getElementById('addReading').value = '';
            document.getElementById('addHint').value = '';

            showAddResult('ÂïèÈ°å„ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºÅ', 'success');

            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
            saveToLocalStorage(grade);
        }

        function showAddResult(message, type) {
            const resultDiv = document.getElementById('addResult');
            resultDiv.textContent = message;
            resultDiv.className = 'add-result ' + type;
            resultDiv.style.display = 'block';

            setTimeout(function() {
                resultDiv.style.display = 'none';
            }, 3000);
        }

        function showQuestionList() {
            const grade = parseInt(document.getElementById('viewGrade').value);
            const listDiv = document.getElementById('questionList');

            if (!kanjiDatabase[grade] || !kanjiDatabase[grade].questions) {
                listDiv.innerHTML = '<p>„Åì„ÅÆÂ≠¶Âπ¥„ÅÆÂïèÈ°å„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }

            const questions = kanjiDatabase[grade].questions;
            if (questions.length === 0) {
                listDiv.innerHTML = '<p>„Åæ„Å†ÂïèÈ°å„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }

            let html = '<h3>' + grade + 'Âπ¥Áîü„ÅÆÂïèÈ°å‰∏ÄË¶ß (' + questions.length + 'Âïè)</h3>';
            questions.forEach(function(q, index) {
                html += '<div class="question-item">';
                html += '<h4>' + q.word + ' (' + q.reading + ')</h4>';
                html += '<p><strong>„Éí„É≥„Éà:</strong> ' + q.hint + '</p>';
                html += '<p><strong>„Çø„Ç§„Éó:</strong> ' + getTypeText(q.type) + ' | ';
                html += '<strong>Èõ£ÊòìÂ∫¶:</strong> ' + getDifficultyText(q.difficulty) + '</p>';
                html += '</div>';
            });

            listDiv.innerHTML = html;
        }

        function getTypeText(type) {
            switch(type) {
                case 'both': return 'Ë™≠„Åø„ÉªÊõ∏„Åç‰∏°Êñπ';
                case 'reading': return 'Ë™≠„Åø„ÉÜ„Çπ„Éà„ÅÆ„Åø';
                case 'writing': return 'Êõ∏„Åç„ÉÜ„Çπ„Éà„ÅÆ„Åø';
                default: return '‰∏çÊòé';
            }
        }

        function getDifficultyText(difficulty) {
            switch(difficulty) {
                case 1: return 'Á∞°Âçò';
                case 2: return 'ÊôÆÈÄö';
                case 3: return 'Èõ£„Åó„ÅÑ';
                default: return 'ÊôÆÈÄö';
            }
        }

        function importQuestions() {
            const data = document.getElementById('importData').value.trim();
            const resultDiv = document.getElementById('importResult');

            if (!data) {
                showImportResult('JSON„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
                return;
            }

            try {
                const jsonData = JSON.parse(data);
                
                if (!jsonData.grade || !jsonData.questions) {
                    throw new Error('Ê≠£„Åó„ÅÑ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
                }

                const grade = jsonData.grade;
                
                // Êó¢Â≠ò„Éá„Éº„Çø„Å®Áµ±Âêà
                if (!kanjiDatabase[grade]) {
                    kanjiDatabase[grade] = {
                        grade: grade,
                        kanjiList: [],
                        questions: []
                    };
                }

                // ÂïèÈ°å„ÇíËøΩÂä†
                jsonData.questions.forEach(function(q) {
                    kanjiDatabase[grade].questions.push(q);
                });

                // Êº¢Â≠ó„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
                if (jsonData.kanjiList) {
                    jsonData.kanjiList.forEach(function(kanji) {
                        if (kanjiDatabase[grade].kanjiList.indexOf(kanji) === -1) {
                            kanjiDatabase[grade].kanjiList.push(kanji);
                        }
                    });
                }

                // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                saveToLocalStorage(grade);

                showImportResult(jsonData.questions.length + 'Âïè„ÇíÂèñ„ÇäËæº„Åø„Åæ„Åó„Åü„ÄÇ', 'success');
                document.getElementById('importData').value = '';

            } catch (error) {
                showImportResult('JSON„Éá„Éº„Çø„ÅÆÂΩ¢Âºè„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì: ' + error.message, 'error');
            }
        }

        function showImportResult(message, type) {
            const resultDiv = document.getElementById('importResult');
            resultDiv.textContent = message;
            resultDiv.className = 'import-result ' + type;
            resultDiv.style.display = 'block';

            setTimeout(function() {
                resultDiv.style.display = 'none';
            }, 5000);
        }

        function exportQuestions() {
            const grade = parseInt(document.getElementById('exportGrade').value);
            const exportArea = document.getElementById('exportData');

            if (!kanjiDatabase[grade] || !kanjiDatabase[grade].questions) {
                exportArea.value = '{"error": "„Åì„ÅÆÂ≠¶Âπ¥„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì"}';
                return;
            }

            const exportData = {
                grade: grade,
                totalKanji: kanjiDatabase[grade].kanjiList ? kanjiDatabase[grade].kanjiList.length : 0,
                kanjiList: kanjiDatabase[grade].kanjiList || [],
                questions: kanjiDatabase[grade].questions
            };

            exportArea.value = JSON.stringify(exportData, null, 2);
        }

        function isKanji(char) {
            return (char >= '\u4e00' && char <= '\u9faf') || 
                   (char >= '\u3400' && char <= '\u4dbf');
        }

        function saveToLocalStorage(grade) {
            try {
                localStorage.setItem('kanjiQuiz_grade' + grade, JSON.stringify(kanjiDatabase[grade]));
            } catch (error) {
                console.warn('„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å∏„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
            }
        }

        function loadFromLocalStorage() {
            for (let grade = 1; grade <= 6; grade++) {
                try {
                    const stored = localStorage.getItem('kanjiQuiz_grade' + grade);
                    if (stored) {
                        const data = JSON.parse(stored);
                        // Êó¢Â≠ò„ÅÆ„Çµ„É≥„Éó„É´„Éá„Éº„Çø„Å®Áµ±Âêà
                        if (kanjiDatabase[grade]) {
                            // ËøΩÂä†„Åï„Çå„ÅüÂïèÈ°å„Çí„Éû„Éº„Ç∏
                            data.questions.forEach(function(q) {
                                const exists = kanjiDatabase[grade].questions.some(function(existing) {
                                    return existing.word === q.word && existing.reading === q.reading;
                                });
                                if (!exists) {
                                    kanjiDatabase[grade].questions.push(q);
                                }
                            });
                        } else {
                            kanjiDatabase[grade] = data;
                        }
                    }
                } catch (error) {
                    console.warn('Â≠¶Âπ¥' + grade + '„ÅÆ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Å´Â§±Êïó:', error);
                }
            }
        }

        // „É¢„Éº„ÉÄ„É´„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇØ„É™„ÉÉ„ÇØÊôÇ„ÅÆÂá¶ÁêÜ
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                hideModal();
            }
        });

        // PWAÂØæÂøú
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(function() {
                // Service WorkerÁôªÈå≤Â§±ÊïóÊôÇ„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            });
        }
    </script>
</body>
</html>